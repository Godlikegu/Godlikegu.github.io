<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Machine learning Chapter1</title>
      <link href="/2024/04/08/Machine-Learning-Chapter1/"/>
      <url>/2024/04/08/Machine-Learning-Chapter1/</url>
      
        <content type="html"><![CDATA[<h1 id="西瓜书Chapter1"><a href="#西瓜书Chapter1" class="headerlink" title="西瓜书Chapter1"></a>西瓜书Chapter1</h1><h2 id="什么是机器学习"><a href="#什么是机器学习" class="headerlink" title="什么是机器学习"></a>什么是机器学习</h2><p><strong>粗俗理解</strong>：像人类一样利用“经验”进行决策。</p><p><strong>较严格定义</strong>：研究如何通过计算的手段，利用经验来改善系统自身的性能。</p><p>这里其实信息量已经不少了：</p><p>1.什么是“经验”？</p><p>对于计算机来说，“经验”通常以“数据”的形式存在，其实本质上就是从训练数据集中通过学习算法得来的一些参数。</p><p>2.机器学习的主要内容？</p><p>研究计算机从数据中产生“模型”的算法，即<strong>学习算法</strong>。</p><p>输入是与训练集中部分数据属于同一集合的数据，输出是新的结果</p><p>3.什么时候要利用“经验”</p><p>当我们遇到相同或相似的问题的时候，或者全新的问题，里面隐含了模型的“泛化”</p><p>4.模型的作用是预测</p><h2 id="机器学习的基本概念（术语）"><a href="#机器学习的基本概念（术语）" class="headerlink" title="机器学习的基本概念（术语）"></a>机器学习的基本概念（术语）</h2><h3 id="sample-instance"><a href="#sample-instance" class="headerlink" title="sample(instance)"></a>sample(instance)</h3><p>描述事件或对象性质的事项，称为一个记录，例如(性别=男，年龄=20)是其中的一个记录</p><h3 id="data-set"><a href="#data-set" class="headerlink" title="data set"></a>data set</h3><p>记录的集合</p><h3 id="label"><a href="#label" class="headerlink" title="label"></a>label</h3><p><strong>sample对应的结果信息</strong>，好/坏，属于某一类，值为多少…….</p><h3 id="example"><a href="#example" class="headerlink" title="example"></a>example</h3><p>样例，<strong>example = (sample,label)</strong></p><h3 id="attribute-feature-及其value"><a href="#attribute-feature-及其value" class="headerlink" title="attribute(feature)及其value"></a>attribute(feature)及其value</h3><p>性别=男，性别是<strong>特征</strong>，男是<strong>特征值</strong></p><h3 id="attribute-sample-space"><a href="#attribute-sample-space" class="headerlink" title="attribute(sample) space"></a>attribute(sample) space</h3><p><strong>属性</strong>张成的空间，也叫样本空间或者输入空间</p><p>相应地，所有label的集合构成输出空间或者标记空间</p><h3 id="feature-vector"><a href="#feature-vector" class="headerlink" title="feature vector"></a>feature vector</h3><p>没一个属性对应高维空间的一个点(x1,x2,x3…)，也即是一个<strong>向量</strong></p><h3 id="hypothesis"><a href="#hypothesis" class="headerlink" title="hypothesis"></a><font color="red">hypothesis</font></h3><p>学得模型对应<strong>关于数据</strong>的某种潜在的<strong>规律</strong>，称为假设</p><p><strong>理解</strong>：从这个数据集，我们假设存在这样的规律</p><h3 id="ground-truth"><a href="#ground-truth" class="headerlink" title="ground-truth"></a><font color="red">ground-truth</font></h3><p><strong>真相</strong>，即真实结果，一般来说不可表示，不可测量，但是客观存在（和物理实验的客观值一样）</p><h2 id="机器学习分类"><a href="#机器学习分类" class="headerlink" title="机器学习分类"></a>机器学习分类</h2><h3 id="预测值离散or连续"><a href="#预测值离散or连续" class="headerlink" title="预测值离散or连续"></a>预测值离散or连续</h3><p>预测的是<strong>离散值</strong>，如“男人”，“女人”，此类任务称为<strong>classification(分类)</strong></p><p><code>如果是两个类别，称为二分类任务，一类称为正类，一类称为负类；若有多个类别则称为多分类任务</code></p><p>预测的是<strong>连续值</strong>，如2024年4月房价为30000r/平米，此类任务称为<strong>regression(回归)</strong></p><h3 id="训练样本有无label"><a href="#训练样本有无label" class="headerlink" title="训练样本有无label"></a>训练样本有无label</h3><p>训练样本<strong>有label</strong>，称为supervised learning(监督学习)</p><p>前述<strong>分类</strong>和<strong>回归</strong>任务都是监督学习的典型样例</p><p>训练样本<strong>无label</strong>，称为unsupervised learning(无监督学习)</p><p><strong>聚类任务(clustering)<strong>：把训练集中的样本分为若干组，每组称为一</strong>“簇”</strong>(cluster)，这种自动形成的簇存在着潜在的概念划分，但是我们事先不知道。（训练样本<strong>通常不</strong>拥有标记信息，但是也有特例，如<strong>半监督聚类</strong>）</p><h3 id><a href="#" class="headerlink" title></a></h3><h2 id="样本分布"><a href="#样本分布" class="headerlink" title="样本分布"></a>样本分布</h2><p>通常假设样本空间中全体样本服从一个未知分布D，我们获得的<strong>每个样本独立地从这个分布上</strong>采样获得的，即“<strong>独立同分布</strong>”（independent and identically distributed,简称i.i.d）</p><h2 id="假设空间"><a href="#假设空间" class="headerlink" title="假设空间"></a>假设空间</h2><p>科学推理的两大手段是归纳和演绎</p><p><strong>归纳(induction)<strong>：特殊到一般，是泛化过程，从具体事实总结出一般性规律（如</strong>机器学习</strong>）</p><p>**演绎(deduction)**：一般到特殊，是特化过程，从基础原理推演出具体情况（如基于公理的数理推导）</p><p>从样例中学习的归纳过程，称为归纳学习</p><h3 id="版本空间"><a href="#版本空间" class="headerlink" title="版本空间"></a>版本空间</h3><p>由于样本集有限，可能有多个假设和训练集一致，这些假设集合称之为<strong>版本空间</strong></p><h3 id="归纳偏好"><a href="#归纳偏好" class="headerlink" title="归纳偏好"></a>归纳偏好</h3><p>机器学习算法在学习过程中对某种类型假设的偏好，称为**“归纳偏好”(inductive bias)**，简称为偏好</p><p>具体来说，有的算法可能适用的情况更少，有的算法适用的情况更多（例如多项式拟合的时候模型的复杂程度），（在不基于特征选择基础上）算法形成的模型对某一特征更加重视等等，都是归纳偏好。</p><p><strong>任何一个有效的机器学习算法必然有其偏好</strong>，否则将无法产生确定的学习结果（同一训练集的版本空间里有多个假设），这样的学习结果没有意义。</p><h3 id="NFL定理"><a href="#NFL定理" class="headerlink" title="NFL定理"></a>NFL定理</h3><p><strong>背景</strong>：我们在比较学习算法优劣的时候，可能存在对于一类问题，A比B好；而另一类问题则相反。</p><p><strong>内容</strong>：假设问题出现的机会均等，总误差的预期和学习算法无关（即乱猜算法和精心设计算法结果一致）</p><p><strong>理解</strong>：在推导NFL定理的时候，假设真实目标函数f满足均匀分布，然而对于某一种特定的问题，只存在一个f，因此我们只需要对于某一特定任务找到合适的解决方法就行，此时精心设计的算法显然比乱猜要好。</p><p><strong>核心</strong>：脱离具体问题空谈哪种学习算法更好是没有意义的，答案是一样好。换句话说，学习算法的归纳偏好和问题是否相配，往往起到决定性的作用。</p><p>推导自行查阅。</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2023-08-03-inspiration</title>
      <link href="/2023/08/03/2023-08-03-inspiration/"/>
      <url>/2023/08/03/2023-08-03-inspiration/</url>
      
        <content type="html"><![CDATA[<h2 id="读书来源"><a href="#读书来源" class="headerlink" title="读书来源"></a>读书来源</h2><p><strong>毛选第一卷–战争的目的在于消灭战争</strong></p><p>毛主席说：“人类社会进步到消灭了阶级，消灭了国家，到了那时，什么战争也没有了……这就是永久和平的时代”。这句话诚然是客观真实的，而且是所有人都应当向往的。然而这样一天真的会到来吗？为什么现在没有到来呢？差异在哪里呢？什么样的条件才会促成这样的社会进步呢？作为一个“性恶论”的忠实拥护者，我认为唯有物质条件极大丰富，人类的一切自私行为（包括但不限于个人行为，群体，乃至国家都一样）所带来的<strong>表观利益</strong> <strong>显著</strong>小于非自私行为，即以全人类为出发点，个体行为不对任何其它个体之外（包括其他人还有自然）产生不良影响的行为所带来的<strong>表观利益</strong>时，这一点才可能实现。</p><h2 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h2><p>我想要强调的是：<br>1.社会的进步必然是物质进步推动精神进步，因为人并非圣人，必有私欲，只有当私欲和公共利益达到统一，才能达到上述所说的地步。当物质满足了，人们发现不需要处处计较的时候，自然好像精神水平又上去了。如果把现代的“精神更加丰富的人”放到原始社会，过了一段时间之后，人们大抵还是要过上和我们先祖一样的生活，饭都吃不饱，安危转化只在旦夕之间，还谈什么道德法制和精神追求？</p><p>2.什么是表观利益？表观指人由于生理算力、心理诱导和其它客观因素的限制，能够预见的利益有限。所谓表观利益便是最能直接驱使人在做出某种决策的因素，这并不等同于短期利益或者长期利益，时间只是考量的因素之一。此外，人的寿命是极其有限的（至少目前是），这也就解释了为什么会出现污染环境发展经济的情况或着发达国家污染发展中国家发展本国经济的情况（当代人活不了那么久，别的国家的人的死活也不会直接影响自己国家的利益，况且生命轮回转世目前都是虚妄之猜测，为什么要处处考虑后代？因此目前提倡保护环境，功在当代利在千秋，以及全球环境保护都是格局极大之举，因此我也十分敬佩每一个环保人士、组织以及提出环保方针的地区或国家领导[*1]）。</p><p>3.为什么要强调显著？因为即使是表观利益很明显，但不足以明显到让人很难忍住不去这么做甚至被迫这么做的时候，其它的因素就会介入进来，比如情感因素等等，当然，是否要将情感单独拿出来尚且不太确定，因为情感本质上也是个人欲望，是多巴胺诱导下的产物，但是情感对决策造成的不确定性和理性分析下客观上的利益对决策的影响确实有很大区别，毕竟嫖娼出轨等恶劣行为的不良后果再大，为了一时之快，也会有人管不住自己的下半身。</p><h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><p>[*1]：即使如此，笔者还认为，呼吁环保造福后代并非延迟满足之举，而是如同法律一般形成一种公约，最终保护的是自己的利益。以下的解释也可以看出私有制的出现是阶级，国家，法律产生造成的根本因素。<br>笔者认为法律的本质是通过公约的方式借助群体阶级力量的阶级自我保护。倘若没有法律，我们当然可以侵害别人利益以满足自己利益而不付出代价，但是这件事情是具有普遍性的，没有任何人能保证自己不被侵害，你能掠夺别人的同时，别人也会来掠夺你。试想，如果真的有人能保证不被别人侵犯还能侵犯别人，那ta一定不希望有法律的出现，因为这本质上不符合ta的利益。因此相比于伺机侵犯，惶惶不可终日，使得个体生活幸福度严重下降；还相互阻挠从而拖垮整体的发展，导致遭受外来其它集体的侵犯而导致自己通过抢夺别人的利益好不容易积累的“大厦”一夜之间轰然倒塌，不如互不侵犯，共同过好自己的生活，相互帮助。但是由于发展的不平衡或者规则的不完备，总会有可以侵害别人而不用担心被别人侵犯的人出现，但是这样的角色是有时空的局限的，今天你是大哥，明天别人也能当，你抢了别人后代的资源，别人也同样会来抢你。不过人们往往不会在乎明天的事情，因此出现了一批贪官和地方的恶霸。<br>保护环境同样如此，我们不为下一代着想，上一代也不会为我们着想。因此大家都过得不好，而且是越来越不好。因此我们需要一个公约，看似保护的是下一代的利益，实则也是保护我们自己的利益。因为现在的我们某种意义上也是以后的我们自己的上一代，这样如同能量守恒般的时间平移对称（不变）性，是非常奇妙的，保护别人，竟然成了保护我们自己。</p>]]></content>
      
      
      
        <tags>
            
            <tag> reading-notes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OO_Unit3</title>
      <link href="/2023/05/18/OO-Unit3/"/>
      <url>/2023/05/18/OO-Unit3/</url>
      
        <content type="html"><![CDATA[<h2 id="测试过程"><a href="#测试过程" class="headerlink" title="测试过程"></a>测试过程</h2><h3 id="黑箱测试与白箱测试"><a href="#黑箱测试与白箱测试" class="headerlink" title="黑箱测试与白箱测试"></a>黑箱测试与白箱测试</h3><h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p><strong>黑箱测试</strong>：也称功能测试、数据驱动测试，它将被测软件看作一个打不开的<strong>黑箱</strong>，主要根据功能需求设计测试用例，进行测试。黑箱测试是从一种<strong>从软件外部</strong>对软件实施的测试，也称功能测试或基于规格说明的测试。其基本观点是：任何程序都可以看作是从输入定义域到输出值域的映射，这种观点将被测程序看作一个打不开的黑箱，黑箱里面的内容(实现)是完全不知道的，只知道软件要做什么。因无法看到箱子中的内容，所以不知道软件是如何实现的，也不关心黑箱里面的结构，只关心软件的输入数据和输出结果。</p><p>我们常用的刷题网站洛谷，leetcode以及我们从大一到大二的每次上机考试，用于验证我们程序正确性的方式基本都是黑箱测试，官方通过构造一系列<strong>数据</strong>和数据输入之后应产生的<strong>正确期望结果</strong>，将数据“喂”给我们的程序，并将产生的答案和上述的<strong>正确期望结果</strong>进行比较，当结果符合预期（<code>符合预期不等于完全相同，如电梯单元多线程只需要保证同步互斥关系都算正确</code>）时，认为程序是正确的。</p><p>综上所述，为什么这种测试方法被称为“黑箱”就显而易见了，我们并不在乎程序具体的实现方式，不管以什么方式获得的正确数据，只要符合预期，都是被认可的，因此这样的测试对测试数据存在要求。当数据太简单或者覆盖面不广泛的时候，我们可以让错误的程序PASS无数组数据，甚至让程序通过“打表”的方式取得预期结果。</p><p><strong>白箱测试</strong>：也称结构测试或逻辑驱动测试，它是知道产品内部工作过程，可通过测试来检测产品内部动作是否按照规格说明书的规定正常进行，按照程序内部的结构测试程序，检验程序中的每条通路是否都有能按预定要求正确工作，而不顾它的功能。本人最擅长也最喜欢的测试方式肉眼debug就是白箱测试的一种，白箱测试的好处是对每一个单元的逻辑都可以进行验证，每一个局部的正确可以进一步保证整体性的功能正确。</p><p>白箱测试的基本覆盖标准：逻辑驱动、循环、基路测试等，主要用于软件验证。“白箱”法的前提是全面了解程序内部逻辑结构、对所有逻辑路径进行测试。在使用这一方案时，测试者必须检查程序的内部结构，从检查程序的逻辑着手，得出测试数据。贯穿程序的独立路径数是天文数字。但即使每条路径都测试了仍然可能有错误。</p><p>原因：</p><p>第一，穷举路径测试决不能查出程序违反了设计规范，即程序本身是个错误的程序。</p><p>第二，穷举路径测试不可能查出程序中因遗漏路径而出错。</p><p>第三，穷举路径测试可能发现不了一些与数据相关的错误。</p><p>白箱测试逻辑驱动方法：语句覆盖、判定覆盖、条件覆盖判定/条件覆盖、条件组合覆盖、路径覆盖。</p><h4 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h4><p>1.检测是否有人机交互错误，是否有数据结构和外部数据库访问错误，是否能恰当地接收数据并保持外部信息（如数据库或文件）等的完整性；</p><p>2.检测行为、性能等特性是否满足要求等； 检测程序初始化和终止方面的错误等；</p><p>3.检测软件功能能否按照需求规格说明书的规定正常工作，是否有功能遗漏；</p><h4 id="区别和联系"><a href="#区别和联系" class="headerlink" title="区别和联系"></a>区别和联系</h4><p>黑箱无需管代码实现的具体逻辑，测试具有整体性，对测试数据的覆盖度有要求；白箱需要把黑箱拆开，看清楚内在的逻辑是否符合需求，从而保证正确性，对逻辑验证的正确性有要求。</p><h3 id="其他测试方法"><a href="#其他测试方法" class="headerlink" title="其他测试方法"></a>其他测试方法</h3><h4 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h4><p>是指对软件中的最小可测试单元进行检查和验证。至于“单元”的大小或范围，并没有一个明确的标准，“单元”可以是一个函数、方法、类、功能模块或者子系统。</p><p>单元测试通常和白盒测试联系到一起，如果单从概念上来讲两者是有区别的，不过我们通常所说的“单元测试”和“白盒测试”都认为是和代码有关系的，所以在某些语境下也通常认为这两者是同一个东西。还有一种理解方式，单元测试和白盒测试就是对开发人员所编写的代码进行测试。</p><p>开发人员做单元测试：</p><p>优点：开发人员对代码最熟悉，而且开发人员编程技能相对比较强，所以开发人员自己写单元测试效率上和覆盖率上都比较高。</p><p>缺点：开发人员平时写业务代码就要花费很多时间，有时候确实没有时间写单元测试；而且大部分开发人员没有太好的测试思想，单元测试可能只是写个最简单的用例就完了；不识庐山真面目，只缘身在此山中，自己的错误往往本来就忽略了，数据的覆盖性可能难以让人满意。</p><p>测试人员做单元测试：</p><p>优点：测试人员有比较系统的测试思想，可以更好地保证用例的覆盖。而且通过写单测测试能更好地了解具体代码结构、流程，对于后续的业务测试也非常有利。</p><p>缺点：测试人员的编程技能相对比较弱，如果不同编程是无法开展单元测试的。并且测试人员对代码没有开发人员熟悉，效率会比较低。</p><p>总的来说，对于个人学习而言，单元测试有助于及时发现问题，避免最后重新寻找bug导致重构。</p><h4 id="功能测试"><a href="#功能测试" class="headerlink" title="功能测试"></a>功能测试</h4><p>又称 behavioral testing (行为测试)，根据产品特性、操作描述和用户场景，测试产品的特征和可操作行为，以确定其满足设计需求。功能测试软件，用来验证应用程序或网站是否能够为目标用户正常工作。用合适的平台、浏览器和测试脚本来确保目标用户的体验足够好，就像应用程序是为市场而专门开发的。功能性测试是根据功能要求对软件进行的测试，确保程序按照预期的方式运行，通过测试系统的所有特性和功能来确保程序与规范的一致性。</p><p>为何需要功能测试</p><p>1.从用户的观点出发，确保系统的实现符合要求</p><p>2.由于是黑盒测试，测试人员对应用程序的内部实现一无所知，能够发现开发人员没有发现的问题，找出遗漏的地方</p><p>3.某些特殊问题可能被测试，如乱操作、不按既定程序运行、检查应用中存在的漏洞</p><p>由此我们可以得出以下结论：功能测试=检查需求的实现+找出功能实现的遗漏+检查应用程序是否存在漏洞。</p><p>功能测试的本质其实就是黑盒测试+单元测试，只不过单元的大小可以自由调节。</p><h4 id="集成测试"><a href="#集成测试" class="headerlink" title="集成测试"></a>集成测试</h4><p>之前我们提到了单元测试可以有效保障每一个单元or模块的正确性，但是一个程序，或者说一个工程最后的运行是需要各个模块合作完成的，模块之间工作的先后关系，接口的匹配都可能存在问题。举一个简单粗暴的例子，把人的每一个“零件”都丢在地上，并不能产生一个活生生的人，因为这些“零件”并没有协调工作，而是各干各的。程序也是如此，因而我们需要对各个模块之间的协调性和接口匹配性进行测试，集成测试应运而生。</p><p>通常，模块是由单个软件开发人员设计的，他们的理解和编程逻辑可能与其他程序员不同，必须进行集成测试，以验证软件模块可以统一工作。<br>此外，在模块开发时，客户有很大的机会改变需求。这些新要求可能未经过单元测试，因此必须进行系统集成测试。集成测试侧重的测试方向有：</p><p>1.软件模块与数据库的接口可能是错误的</p><p>2.外部硬件接口（如果有）可能是错误的</p><p>3.异常处理不充分可能会导致问题。</p><p>4.新开发的功能模块代码合并到主分支代码需要进行集成测试。</p><h4 id="压力测试"><a href="#压力测试" class="headerlink" title="压力测试"></a>压力测试</h4><p>压力测试是一种基本的质量保证行为，它是每个重要软件测试工作的一部分。软件压力测试的基本思路很简单：不是在常规条件下运行手动或自动测试，而是在计算机数量较少或系统资源匮乏的条件下运行测试。通常要进行软件压力测试的资源包括内部内存、CPU可用性、磁盘空间和网络带宽。压力测试涵盖，性能测试，负载测试，并发测试等等，这些测试点常常交织耦合在一起。</p><p>压力测试主要是针对在有限的资源下如何尽可能地提升程序的性能，节省空间资源和时间资源。比如第十二次作业对qlm方法就有一定的要求。或者指令条数不小心超过了事先的约定情况，这很好地模拟了顾客错误操作程序，或者大量服务请求导致资源容量相对不足的情况，如果程序因此而直接崩溃，说明鲁棒性和异常处理仍然不够。而倘若程序仍然能够“超额”完成一些指标，那说明你做的还不错。</p><h4 id="回归测试"><a href="#回归测试" class="headerlink" title="回归测试"></a>回归测试</h4><p>回归测试被定义为一种软件测试类型，以确认新的程序或代码更改未对现有功能产生影响。具体体现为全部或部分选择已执行的测试用例，然后重新执行以确保现有功能正常运行。</p><p>乍一看，回归测试和回马一枪再猛测你的码似乎没有什么区别，那有必要引入这样一个新的测试方法吗？其实重新测试和回归测试之间是存在区别的：</p><p>重新测试意味着再次测试功能或错误以确保代码已修复。如果不是固定的，则需要重新打开缺陷。如果已修复，则关闭缺陷。</p><p>回归测试是指在对软件应用程序进行代码更改时对其进行测试，以确保新代码不会影响软件的其他部分。</p><h3 id="测试工具"><a href="#测试工具" class="headerlink" title="测试工具"></a>测试工具</h3><p>静态代码分析和简要构造数据的单元测试，以及同学提供的测试平台。</p><h3 id="数据构造策略"><a href="#数据构造策略" class="headerlink" title="数据构造策略"></a>数据构造策略</h3><p>1.单元测试：<br>针对单个不同的功能（本单元主要体现为请求）进行独立测试，比如强测数据点中的qlm稠密图和稀疏图的测试。</p><p>2.集成测试：<br>乱棍打死老师傅，把不同的功能糅合到一起，看看各个功能之间的独立性是否满足要求。比如笔者采用了并查集这一数据结构，并且是动态维护的，这意味着同一个并查集作为一个引用对象是共享的，因此要时刻保证并查集的正确性。</p><p>3.压力测试：<br>构造边界数据，甚至故意构造一些非法数据检验程序的鲁棒性。比如把指令条数设置为超过10000条，构造很复杂的图模型，把人的name设置为带有各种奇怪符号，人的id尽可能奇怪，尽可能使得qlm运行较长时间等。</p><h2 id="架构设计"><a href="#架构设计" class="headerlink" title="架构设计"></a>架构设计</h2><p>1.主要的设计是采用arraylist和hashmap分离的思想，arraylist用于遍历，hashmap用于尽快地查找，但是这样做未免有些冗余，因为要时刻保证arraylist的内容和hashmap是一致的，因此很容易出现错误，使得编程压力较大。</p><p>2.对于人物关系采用了并查集进行维护，然而并查集对于人物关系的添加较为简单，而对于人物关系的删除则十分考验人，需要对并查集进行块内部的重新整合，很容易错。这里笔者采用了bfs进行块的寻找与潜在的块的重新划分。now是现在所在的节点，goal是打算将这个节点以及和这个节点所在块的所有节点都统一father的id为goal。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">modifyFather</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> now<span class="token punctuation">,</span> <span class="token class-name">Integer</span> goal<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        vis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>peopleMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        father<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>now<span class="token punctuation">,</span> goal<span class="token punctuation">)</span><span class="token punctuation">;</span>        vis<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>now<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>queue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">MyPerson</span> person <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MyPerson</span><span class="token punctuation">)</span> queue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Person</span> p <span class="token operator">:</span> person<span class="token punctuation">.</span><span class="token function">getAcquaintance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>vis<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">Integer</span> id <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>                    father<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> goal<span class="token punctuation">)</span><span class="token punctuation">;</span>                    vis<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="性能问题及修复"><a href="#性能问题及修复" class="headerlink" title="性能问题及修复"></a>性能问题及修复</h2><p>笔者碰到的性能问题主要是最后一次作业的qlm超时的问题，在Memory方面没有出现明显问题。</p><p>修复思路：在dijkstra方法的基础上使用堆优化，对已经排除的路径及时剪枝，避免重复寻找。</p><h3 id="其他bugs"><a href="#其他bugs" class="headerlink" title="其他bugs"></a>其他bugs</h3><p>1.Integer类的比较不能轻易用==。查看jdk源码，在使用==比较Integer类型时，默认会缓存 -128至127（包括-128和127），如果超过这个范围，则会new，所以两个对象内存的首地址不一样，==返回false，因此使用equals才是上策。</p><p>2.在使用remove方法对Arraylist批量删除的时候，笔者常常建立一个中间容器，这样做十分笨拙，可以采用倒序删除的方法，让数组自动紧凑，无需担心index的变化。此外，remove(Object)方法的特点是：当没有重写equals方法的时候，按照引用寻找待删除的对象；当重写equals方法的时候，只要在数组中找到和obj满足equals关系的第一个引用对象就直接删除，这样可能导致删除的元素是错误的，这个bug十分神奇。官方对Person和Message的equals方法规定强行重写，最后也没有发现有什么用，还给编程带来了一些难以预料的麻烦，建议修改此处。</p><h2 id="OK测试方法"><a href="#OK测试方法" class="headerlink" title="OK测试方法"></a>OK测试方法</h2><p>对于qts,mr,qlm三个重点方法进行了OKtest，在我看来，OKtest可以一个点一个点地对规格的要求进行检查，只要Oktest正确编写，几乎万无一失。但是OKtest也有缺点，那就是当规格要求太多的时候，比如第十次作业22个验证点，OKtest本身就容易存在问题，而且编程难度也加大了，这与我们的初衷违背，因此需要进行trade off，对于Oktest需要划分更小，对于约束很多的方法，需要对方法内部进行进一步划分。</p><h2 id="感想和学习体会"><a href="#感想和学习体会" class="headerlink" title="感想和学习体会"></a>感想和学习体会</h2><p>虽然对jml的用处体会不是特别深刻，不过本单元很好地揭露了本人对于单元测试能力较弱的痛处，这提醒笔者如果以后接手较大的工程或者担任项目经理的时候，一定要及时进行单元测试。此外，对于测试数据需要精心构造，不仅要保证数据的复杂度，还要保证数据的覆盖程度，有一些很简单的地方如果不进行测试也有可能会出现错误。第三单元真的是太酷辣，BUAAOO是世界上最好的OO，只要不读航空航天我就是北大的辣。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>OO-U2</title>
      <link href="/2023/04/12/OO-U2/"/>
      <url>/2023/04/12/OO-U2/</url>
      
        <content type="html"><![CDATA[<h1 id="Hw5架构与代码分析"><a href="#Hw5架构与代码分析" class="headerlink" title="Hw5架构与代码分析"></a>Hw5架构与代码分析</h1><h2 id="题面"><a href="#题面" class="headerlink" title="题面"></a>题面</h2><p>模拟多电梯实时系统，楼层从1至11楼，设计需要根据乘客在不同时间点的请求输入满足上下行，开关门，以及模拟乘客的进出的需求。初始默认有6部电梯且均在1楼。</p><h2 id="设计分析"><a href="#设计分析" class="headerlink" title="设计分析"></a>设计分析</h2><p>输入线程在不同的时间节点导入请求，电梯线程负责满足（消耗）这些请求。这是一个典型的<strong>生产者-消费者</strong>模型。其中输入线程是生产者线程，电梯是消费者线程，中间有一个”托盘”用于存放乘客的请求，不妨称之为<strong>请求队列(requestList)<strong>，表示处于该队列中的请求</strong>已经发出但尚未被分配</strong>到具体的电梯上。相应地，每个电梯名下都有一个<strong>只属于该电梯的请求表</strong>(用HashMap&lt;Integer, Arraylist&lt; PersonRequest &gt;&gt;表示，其中Integer表示楼层数， Arraylist&lt; PersonRequest &gt;用于储存该楼层对应的请求集合)。</p><p>至此，一个大体的框架已经出现了：输入线程(Input类)，电梯线程(Elevator类), 调度器线程(Distributor类，决定把请求分配给哪一个电梯)。此外，为了迭代的灵活性和更好地满足<strong>开闭原则</strong>，课程组建议我们写一个Schedule类，并给每一个电梯分配一个Schedule类作为其属性，用来控制电梯的上下与开关门。这样一来，如果后续有不同种类的电梯（如横向电梯），我们可以通过继承或重写Schedule类来减少代码的修改量。</p><p>值得注意的是，<strong>对于消费的过程，其实当乘客从请求队列里被取出并分配到某个具体的电梯里就已经结束了</strong>，因为此时已经将请求队列对应的容器进行了remove操作，消费过程结束。<code>注意：这里在取出的时候需要先判断请求队列是否为空</code>（来自OS的好习惯try(LIST_EMPTY())）。<strong>如果请求队列为空且输出线程已经结束，直接将电梯停运(END)，结束对应的电梯线程；如果此时请求队列为空但是输出线程尚未结束，则将电梯处于等候(WAIT)状态，并用wait将该电梯线程挂起，减少CPU的忙等。</strong> 相应地，当有请求从存入的时候在最后必须notifyAll()，让可能处于wait状态的电梯进入工作。</p><h2 id="多线程安全分析与多线程语法设计细节"><a href="#多线程安全分析与多线程语法设计细节" class="headerlink" title="多线程安全分析与多线程语法设计细节"></a>多线程安全分析与多线程语法设计细节</h2><h3 id="线程交互可能性分析"><a href="#线程交互可能性分析" class="headerlink" title="线程交互可能性分析"></a>线程交互可能性分析</h3><p>这里存在交互的线程主要是<strong>输入线程和调度器线程</strong>，以及<strong>调度器线程和电梯线程</strong>。<br>理由如下：<br>1.调度器线程是否能结束取决于输入线程是否结束以及请求队列是否为空。<br>2.调度器需要监控电梯的实时状态决定将请求队列中的请求分配给哪一部电梯。如电梯现在在几楼，电梯的运行方向如何，电梯是否满员等。<br>3.电梯线程是否能结束要根据电梯属性中的请求表(上文介绍的哈希表)及电梯内部人员集合是否为空，还有输入线程是否结束两方面来判断。即使电梯已经完成了目前的任务，请求表为空且电梯内的乘客均已送至目的楼层，仍然需要判断调度器线程是否结束。</p><h3 id="线程安全具体解决方案"><a href="#线程安全具体解决方案" class="headerlink" title="线程安全具体解决方案"></a>线程安全具体解决方案</h3><p>由于这样的交互存在，相应地也存在<strong>两对设计线程安全的共享访问对象</strong>。</p><ol><li><p>调度器和输入线程之间共享了请求队列。因此对于请求队列的add方法和getAndRemove方法需要进行synchronized上锁。由于队列没有长度限制，add方法不需要额外判断进行wait操作。但是getAndRemove中设计remove操作，而队列的下限显然是空队列，因此对于getAndRemove方法，需要提前判空。如果while(请求队列为空）则wait()是不对的。因为最后请求队列必为空，此时单纯靠判空进行wait()的话无法结束调度器线程。因此我们还需要知道Input线程是否已经结束，从供求关系来看，当Input线程结束且请求队列为空，则请求队列将一直为空，调度器可以停止工作。因此getAndRemove方法中包含wait()的while()条件应该是<strong>请求队列为空且Input线程结束</strong>。</p><p> 那么问题来了，如何表示Input线程已经结束呢。笔者本想用java提供的多线程语法来表示，但是觉得有些不便，因此选择对一个布尔变量InputEnd进行置位。问题又来了，这个变量应该作为谁的属性呢？Input，Distributor还是RequestList呢？由于wait所在同步块和判断的循环都在RequestList的getAndRemove方法中，且RequestList是Input线程和Distributor线程都具有的private属性(其实这里可以采用单例模式开发RequestList，使得代码鲁棒性增强)，<strong>故应该把InputEnd作为RequestList的属性</strong>。并且对此属性进行读写上锁，对应isInputEnd和setInputEnd方法。综上所述，while里的条件改写为IsEmpty &amp;&amp; ! IsInputEnd。相应地，在setInputEnd方法的结尾也应该有NotifyAll()方法，这样才能在最后唤醒Distributor线程，执行最后一次while判断并退出。<strong>此外，最后一次由于getAndRemove方法退出的时候是IsEmpty且IsInputEnd的，故无法get到实际内容，我们可以返回null或者返回一个非法id的请求，当Distributor调用getAndRemove得到这个异常值的时候，标志着Distributor结束，同时也解决了Distributor的结束标志问题</strong>相应地，Distributor结束了，电梯仍然可能处于WAIT状态，那么如何结束电梯线程呢？这一点其实和Distributor线程的结束异曲同工，在第二点中介绍。</p></li><li><p>调度器和电梯之间共享了属于某个电梯的<strong>请求表类</strong>（主体为HashMap），但是HashMap不是线程安全的，我们需要对其put,get和remove操作进行加锁。由于这里是哈希表，当电梯到达某一层的时候如果本层请求为空，电梯不会开门（后续LOOK算法中实现），因此在这里进行getAndRemove操作时<strong>不需要提前判断是否为空</strong>。但是在remove之后，如果本层为空，则将该层的键值对整体从HashMap中移走。这样做的目的是判断有无需要在floor层上电梯的乘客时可以直接用ContainsKey(floor)进行判断。相应地，在put的时候就需要额外进行判断，当containsKey为false的时候，说明这个请求是本楼层的第一个请求，需要new一个arraylist放入此请求并连同楼层数一起put进哈希表；当containsKey为true的时候，直接get到arraylist并对arryalist进行add即可。这里在电梯线程未结束且电梯处于WAI状态的时候会调用<strong>请求表类</strong>中的Requestwait()函数（只是将wait包含在synchronized块中），等待put操作的notifyALL。</p><p> 此外，对于上一点中提出的elevator的线程结束问题，我们也采用一个标志位isDistributorEnd放在<strong>请求表类</strong>中。具体操作与第一点相同，写明一个isEnd函数和一个置位函数作为读写函数（需要synchronized保护）。当Distributor退出线程的时候调用置位函数，当电梯完成所有任务且IsEnd被置位的时候，退出电梯线程。</p></li></ol><p><code>总结：这里使用了两组生产者-消费者模型，其中Distributor调度器类既是消费者（将请求从请求队列中取出），又是生产者(将请求放入电梯的请求表类中)。并用两个布尔变量和对应的加锁方法判断线程是否结束。wait和notifyALL的时机也非常重要，绝对不能少，也不要滥用。</code></p><h3 id="电梯运行算法——LOOK"><a href="#电梯运行算法——LOOK" class="headerlink" title="电梯运行算法——LOOK"></a>电梯运行算法——LOOK</h3><p>这里直接采用了第七次的架构，直接忽略maintian和access即可。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">State</span> <span class="token function">nextState</span><span class="token punctuation">(</span><span class="token keyword">int</span> floorNow<span class="token punctuation">,</span> <span class="token keyword">boolean</span> direction<span class="token punctuation">,</span>                           <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyPersonRequest</span><span class="token punctuation">></span></span> destRequestList            <span class="token punctuation">,</span> <span class="token keyword">int</span> numOfPassenger<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isMaintain<span class="token punctuation">,</span> <span class="token class-name">State</span> state<span class="token punctuation">,</span> <span class="token keyword">int</span> capacity<span class="token punctuation">,</span> <span class="token keyword">int</span> access<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>isMaintain<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token class-name">State</span><span class="token punctuation">.</span><span class="token constant">MAINTAIN</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token class-name">State</span><span class="token punctuation">.</span><span class="token constant">MAINTAIN</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token class-name">State</span><span class="token punctuation">.</span><span class="token constant">OVER</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">existOut</span><span class="token punctuation">(</span>floorNow<span class="token punctuation">,</span> destRequestList<span class="token punctuation">)</span> <span class="token operator">||</span>                <span class="token function">existIn</span><span class="token punctuation">(</span>direction<span class="token punctuation">,</span> numOfPassenger<span class="token punctuation">,</span> floorNow<span class="token punctuation">,</span> capacity<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>access <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token class-name">State</span><span class="token punctuation">.</span><span class="token constant">OPEN</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>numOfPassenger <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token class-name">State</span><span class="token punctuation">.</span><span class="token constant">MOVE</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>requestList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>requestList<span class="token punctuation">.</span><span class="token function">getisOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">return</span> <span class="token class-name">State</span><span class="token punctuation">.</span><span class="token constant">OVER</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">return</span> <span class="token class-name">State</span><span class="token punctuation">.</span><span class="token constant">WAIT</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>requestList<span class="token punctuation">.</span><span class="token function">hasAheadRequest</span><span class="token punctuation">(</span>floorNow<span class="token punctuation">,</span> direction<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token class-name">State</span><span class="token punctuation">.</span><span class="token constant">MOVE</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token class-name">State</span><span class="token punctuation">.</span><span class="token constant">REV</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>课上PPT有一句发人深省的话“面向对象就是面向生活”，虽然不知道这句话的作者生活面向得如何（但愿TA被温柔以待），但是LOOK架构确实很符合日常生活的电梯行为。大概思想是：只接同方向的乘客，保证电梯里的乘客都是向一个方向运行的。因此只要电梯里有人，电梯就会一往无前。当电梯里没有人的时候，需要分支判断：<br>1.如果电梯的<strong>请求表类</strong>为空，任意一层都没有即将上电梯的乘客。如果此时getisOver(对应调度器线程结束时对请求表类的置位)已经被置位，那么电梯线程结束。如果此时没有被置为，电梯线程设为WAIT状态(调用Requestwait()函数，避免CPU忙等）。<br>2.如果电梯的<strong>请求表类</strong>不为空：如果电梯前方有请求的话（前方指的是方向，如果电梯向上前方就是楼上，反之则反之）继续MOVE，反之则电梯后方有请求，将状态设置为REV调头，改变电梯运行的方向。</p><p><br><br><br>注：此处参考了<code>https://hyggge.github.io/2022/04/29/oo/oo-di-er-dan-yuan-zong-jie/</code>的博客, 学长（也可能是学姐）使用的枚举类表示电梯的状态非常简洁，可读性极强，让人爱不释手，十分值得学习。</p><h2 id="调度器算法"><a href="#调度器算法" class="headerlink" title="调度器算法"></a>调度器算法</h2><p>笔者一开始采用的是%6+1,保证每部电梯被均匀地调度。然而贪心不足蛇吞象，笔者加入了性能怪的大军中，迷失了初心。本意是当有乘客顺路可以接到的话就一起接上，但是忽略了电梯是否满载的问题，以及产生优先级函数的参数调整不合理。最后导致强测只有一部电梯一直处于运行而TLE，十分可惜。</p><p>这里就建议采用%6+1。其他模拟方法超出了笔者的能力范围，也不是多线程架构的初衷，本文不予以过多介绍。</p><h2 id="出现过的BUG和测试建议"><a href="#出现过的BUG和测试建议" class="headerlink" title="出现过的BUG和测试建议"></a>出现过的BUG和测试建议</h2><p>1.前方<strong>有没有请求</strong>和<strong>请求方向是否一致</strong>是两码事，小心混淆；<br>此外，aheadDirection里面判断的是getFromFloor &gt; 或 &lt; floorNow,<strong>不要带等号</strong>，否则当电梯接一个从3到2楼的乘客的时候，刚到三楼的时候，本来应该进入reverse(转向)状态，但是由于等号成立，会导致继续move到4楼，然后在reverse，甚至发生从1楼到100楼的现象。由于request不会有1楼一下，11楼以上的情况，所以我们不用特判到达1或11楼与否，在刚到达1或11楼电梯只可能有如下几种状态：reverse(move之前),over,wait,open。<br> <img src="https://img-blog.csdnimg.cn/38a6d774fa1d43a4a9cb52ea1684cbcf.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/f9542dba510c42348a66a31547840c0c.png" alt="在这里插入图片描述"></p><p><br><br><br>2.<br>我一开始把size &lt; 6写成了&lt;=6，导致可以进去七个人，正常人一般不会犯下这样的错误<br><img src="https://img-blog.csdnimg.cn/f953a2ec49f041828b01e55f00942a7e.png" alt="在这里插入图片描述"></p><p><br><br><br>3.<br>先让人出来，再让人进去，保证可进入人数最大化。出入最好分开。意思是一arrive就开门，一开门就出去，然后等0.4s，给乘客赶到电梯的时间（等待Input线程可能可稍带的读入。（这个也不算BUG了，只是建议）<br><img src="https://img-blog.csdnimg.cn/2f9b0ee6032746feb1bd596cb5c0b034.png" alt="在这里插入图片描述"></p><p><br><br></p><p>测试建议：<br>1.高频反向接人(测试strategy)<br>2.大客流量综合投入(测试电梯容纳上限)<br>3.大客流量分批投入(测试tle与否)<br>4.压线大客流量投入(时间卡在50s)</p><p>至此，Hw5的架构基本完成。</p><h1 id="Hw6架构与代码分析"><a href="#Hw6架构与代码分析" class="headerlink" title="Hw6架构与代码分析"></a>Hw6架构与代码分析</h1><h2 id="增加需求"><a href="#增加需求" class="headerlink" title="增加需求"></a>增加需求</h2><p>新增maintain已经存在的电梯和add新电梯的情况。当电梯maintain的时候，就近停下，要求maintain之后arrive的次数&lt;=2。新电梯的容量，速度等参数都可以在一定范围内自定义。</p><h2 id="新的问题与解决"><a href="#新的问题与解决" class="headerlink" title="新的问题与解决"></a>新的问题与解决</h2><h3 id="add新电梯的设计"><a href="#add新电梯的设计" class="headerlink" title="add新电梯的设计"></a>add新电梯的设计</h3><p>之前的6部基础电梯的基本参数都是固定的，我们在Hw5的架构中对于Elevator的构造函数可能会传入Magic Number，这样从可读性来说不是很好，也不便于后续的迭代和扩展。因此，在Hw5中我们使用的构造函数应该包含默认参数传递，如果我们没有传入新的参数，则有一个default值，这样便可以支持自定义参数电梯。电梯的其余行为可以不变。</p><p><code>心得与反思：倘若之前直接传入了Magic Number如6,200等参数，则在add自定义电梯的时候，需要把所有的判断条件都进行修改。如判断电梯是否满乘的时候要改成if (numOfPassengers == capacity)，open和close的时间也要改成time*1000。这样的工作应该在首次架构中做好</code></p><h3 id="调度器结束判断条件的修改"><a href="#调度器结束判断条件的修改" class="headerlink" title="调度器结束判断条件的修改"></a>调度器结束判断条件的修改</h3><p>之前调度器的结束条件是<strong>请求队列为空</strong>且<strong>Input线程结束</strong>。由于maintain的存在，导致即使之前介绍的两个条件已经满足，也可能存在新的maintain，导致有乘客被迫下电梯而没有到达目的地。这样的情况下，我们需要重新把乘客放入请求队列中重新调度，因此结束的条件变得更为复杂。仔细思考后，我们发现Input结束后不会再出现新的maintain，当相应电梯执行完maintain指令之后就能保证不会再有任何请求进到请求队列中等候调度。此时如果请求队列为空，则可以判定调度器线程结束。因此我们很容易可以想到用一种类似于信号量机制的整数变量<br>来记录已经发出却尚未得到电梯响应的maintain命令数量。<strong>初始的时候numOfMaintain置为0，当Input线程输入一个maintain指令的时候，这个变量++。当电梯响应maintian，把所有乘客赶下电梯放入请求队列并从存放电梯的数组elevators中移除被maintain的电梯之后，这个变量–。当这个变量为0且Input线程已经结束的时候，便不会再出现新的maintain。</strong> 值得注意的是，这个numOfmaintain在自增的时候是由Input线程控制的，而自减的时候是由elevator线程控制的，因此是共享变量，存在线程安全问题，对于其自增add方法和自减sub方法都需要进行上锁。对该变量的读get方法也需要上锁。这个变量由于决定了Distributor的结束与否，因此也应该和之前的分析一样，放在请求队列RequestList中，并将RequestList的getAndRemove方法中wait的条件改**requests.isEmpty() &amp;&amp; (!(isOver（表示Input线程是否结束，前面有介绍） == true &amp;&amp; getNumOfMaintain == 0))**。相应地，在numOfMaintain的sub方法的末尾应该加上NotifyAll()；因为有可能是最后一次sub方法唤醒Distributor线程，重新判断getNumOfMaintian的值是否被减为0。</p><h3 id="电梯被maintain的处理"><a href="#电梯被maintain的处理" class="headerlink" title="电梯被maintain的处理"></a>电梯被maintain的处理</h3><p>在Elevator类中添加isMaintain的布尔类型属性，并配置线程安全的读get和写set方法。当Input线程有maintain请求的时候，调用对应id电梯的set方法，将isMaintain置为true。相应地，在电梯的状态枚举类中添加MAINTAIN。此外，在电梯的schedule运行策略中需要在一开始就判断是否isMaintain为true。如果为true，则执行相应代码，把未到达目的地的乘客重新new一个新的请求，目的是改变乘客的出发楼层。<strong>不要忘了把该电梯名下的请求表中的乘客原样返回到请求队列中</strong>，并把电梯从elevators中移除 。如果电梯的状态为MAINTIAN，下一次直接OVER即可，结束电梯线程。</p><h2 id="调度策略"><a href="#调度策略" class="headerlink" title="调度策略"></a>调度策略</h2><p>之前采用的是mod6+1的策略。如果直接迁移的话，本次应该采用mod numOfElevators + 1的方式。但这样可能并不能达到我们的目的，原因是当有电梯被maintain或add的时候，电梯数目会随时发生改变，可能不能达到均匀分配的效果。因此我采用了LRU算法，每个电梯加一个timeOfNotUsed属性，记录电梯多久没被使用。每一轮都加1，如果电梯被使用则清零。每次调度时，遍历电梯数组，选出timeOfNotUsed最大的电梯进行请求分配即可。</p><p>至此，Hw6也可以顺利完成（<code>注：本次开发采用了效率更高的读写锁</code>）</p><h1 id="Hw7架构与代码分析"><a href="#Hw7架构与代码分析" class="headerlink" title="Hw7架构与代码分析"></a>Hw7架构与代码分析</h1><h2 id="增加需求-1"><a href="#增加需求-1" class="headerlink" title="增加需求"></a>增加需求</h2><p>本次作业增加的需求主要体现在电梯的可达性，新add的电梯里会有残疾电梯只能在某几层开门停留。存在电梯的换乘问题。此外，还要求同一层最多有4个正处于开门状态的电梯，最多有2个电梯只接人（开门前乘客集合是开门后乘客集合的子集）。</p><h2 id="新的问题与解决-1"><a href="#新的问题与解决-1" class="headerlink" title="新的问题与解决"></a>新的问题与解决</h2><h3 id="满足同一层开门和只接人电梯数目要求"><a href="#满足同一层开门和只接人电梯数目要求" class="headerlink" title="满足同一层开门和只接人电梯数目要求"></a>满足同一层开门和只接人电梯数目要求</h3><p>同一层开门和接人数目的限制其实是一种有限个数的共享资源，很容易想到采用信号量机制的方式对其进行限制。<br>这里我采用了自己手写的信号量机制，原理都一样。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FloorState</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> inserviceMax <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> receiveOnlyMax <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> inserviceArray<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> receiveOnlyArray<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">FloorState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>inserviceArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>receiveOnlyArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">subInService</span><span class="token punctuation">(</span><span class="token keyword">int</span> curFloor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        inserviceArray<span class="token punctuation">[</span>curFloor<span class="token punctuation">]</span> <span class="token operator">=</span> inserviceArray<span class="token punctuation">[</span>curFloor<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">subReceiveOnly</span><span class="token punctuation">(</span><span class="token keyword">int</span> curFloor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        receiveOnlyArray<span class="token punctuation">[</span>curFloor<span class="token punctuation">]</span> <span class="token operator">=</span> receiveOnlyArray<span class="token punctuation">[</span>curFloor<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        inserviceArray<span class="token punctuation">[</span>curFloor<span class="token punctuation">]</span> <span class="token operator">=</span> inserviceArray<span class="token punctuation">[</span>curFloor<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">checkInserviceFullAndAdd</span><span class="token punctuation">(</span><span class="token keyword">int</span> curFloor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>inserviceArray<span class="token punctuation">[</span>curFloor<span class="token punctuation">]</span> <span class="token operator">==</span> inserviceMax<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        inserviceArray<span class="token punctuation">[</span>curFloor<span class="token punctuation">]</span> <span class="token operator">=</span> inserviceArray<span class="token punctuation">[</span>curFloor<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">checkReceiveOnlyFullAndAdd</span><span class="token punctuation">(</span><span class="token keyword">int</span> curFloor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>receiveOnlyArray<span class="token punctuation">[</span>curFloor<span class="token punctuation">]</span> <span class="token operator">==</span> receiveOnlyMax<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        receiveOnlyArray<span class="token punctuation">[</span>curFloor<span class="token punctuation">]</span> <span class="token operator">=</span> receiveOnlyArray<span class="token punctuation">[</span>curFloor<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>        inserviceArray<span class="token punctuation">[</span>curFloor<span class="token punctuation">]</span> <span class="token operator">=</span> inserviceArray<span class="token punctuation">[</span>curFloor<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>注意：receiveOnly（只接人）是inservice（开门）其中的一种情况即可，前者改变，后者也要跟着变。此外，在add的时候检查人数是否已满应该是一个一气呵成的过程，倘如单独拿出一个块用于检查，再拿出一个块用于add，很有可能产生线程不安全。例如现在inservice为3，来了两个电梯，检查都可以进入，然后都进行add操作，inservice则会变成5，这显然不对。相应地在sub这二者的情况下，需要notifyAll()唤醒目前想要开门但被最大服务数目限制的电梯线程。</code></p><h3 id="可达性分析与换乘策略"><a href="#可达性分析与换乘策略" class="headerlink" title="可达性分析与换乘策略"></a>可达性分析与换乘策略</h3><p>代码如下</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">Elevator</span> <span class="token function">getTheBestElevator</span><span class="token punctuation">(</span><span class="token class-name">MyPersonRequest</span> req<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token comment">//// 传入新的personrequest</span>        rlock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            minTimes <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>            sitAdvices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            backAdvices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> start <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getFromFloor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> dest <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getToFloor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> vis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> useableIndexs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> elevators<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Elevator</span> e <span class="token operator">=</span> elevators<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getOpenFloorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>start<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span><span class="token function">getOpenFloorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>dest<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                     <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getUnusedTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                        useableIndexs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token class-name">SitAdvice</span> sitAdvice <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SitAdvice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> dest<span class="token punctuation">)</span><span class="token punctuation">;</span>                    backAdvices<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sitAdvice<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>useableIndexs<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">int</span> max <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>                <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span> i <span class="token operator">:</span> useableIndexs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>elevators<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUnusedTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> max<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        max <span class="token operator">=</span> elevators<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUnusedTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        index <span class="token operator">=</span> i<span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>                req<span class="token punctuation">.</span><span class="token function">setNextFloor</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getToFloor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> elevators<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> elevators<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Elevator</span> e <span class="token operator">=</span> elevators<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getOpenFloorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>start<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    vis<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                    getOffFloor <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>                    <span class="token function">dfs</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> start<span class="token punctuation">,</span> dest<span class="token punctuation">,</span> vis<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getOpenFloorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    vis<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">int</span> maxTime <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> resNextFloor <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sitAdvices<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SitAdvice</span> advice <span class="token operator">:</span> sitAdvices<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>elevators<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>advice<span class="token punctuation">.</span><span class="token function">getElevatorIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUnusedTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> maxTime<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        maxTime <span class="token operator">=</span> elevators<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>advice<span class="token punctuation">.</span><span class="token function">getElevatorIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUnusedTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        index <span class="token operator">=</span> advice<span class="token punctuation">.</span><span class="token function">getElevatorIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        resNextFloor <span class="token operator">=</span> advice<span class="token punctuation">.</span><span class="token function">getGetOffFloor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SitAdvice</span> advice <span class="token operator">:</span> backAdvices<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>elevators<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>advice<span class="token punctuation">.</span><span class="token function">getElevatorIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUnusedTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> maxTime<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        maxTime <span class="token operator">=</span> elevators<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>advice<span class="token punctuation">.</span><span class="token function">getElevatorIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUnusedTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        index <span class="token operator">=</span> advice<span class="token punctuation">.</span><span class="token function">getElevatorIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        resNextFloor <span class="token operator">=</span> advice<span class="token punctuation">.</span><span class="token function">getGetOffFloor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            req<span class="token punctuation">.</span><span class="token function">setNextFloor</span><span class="token punctuation">(</span>resNextFloor<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getPersonId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">" : next floor"</span><span class="token operator">+</span>resNextFloor<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">///////////////////////////</span>            <span class="token keyword">return</span> elevators<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            rlock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token keyword">int</span> firstIndex<span class="token punctuation">,</span> <span class="token keyword">int</span> times<span class="token punctuation">,</span> <span class="token keyword">int</span> start<span class="token punctuation">,</span> <span class="token keyword">int</span> destination<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> vis<span class="token punctuation">,</span>                    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> access<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        rlock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>times <span class="token operator">></span> minTimes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> elevators<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>vis<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">continue</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token class-name">Elevator</span> e <span class="token operator">=</span> elevators<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">isUsable</span><span class="token punctuation">(</span>access<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>times <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">Elevator</span> first <span class="token operator">=</span> elevators<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>firstIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">int</span> minGap <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">11</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getOpenFloorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> first<span class="token punctuation">.</span><span class="token function">getOpenFloorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>j <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">&lt;</span> minGap<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                    minGap <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>j <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>                                    getOffFloor <span class="token operator">=</span> j<span class="token punctuation">;</span>                                <span class="token punctuation">&#125;</span>                            <span class="token punctuation">&#125;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>                    vis<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getOpenFloorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>destination<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">Elevator</span> first <span class="token operator">=</span> elevators<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>firstIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>times <span class="token operator">==</span> minTimes <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            <span class="token class-name">SitAdvice</span> sitAdvice <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SitAdvice</span><span class="token punctuation">(</span>firstIndex<span class="token punctuation">,</span> getOffFloor<span class="token punctuation">)</span><span class="token punctuation">;</span>                            backAdvices<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sitAdvice<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">if</span> <span class="token punctuation">(</span>first<span class="token punctuation">.</span><span class="token function">getUnusedTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                                sitAdvices<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sitAdvice<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>times <span class="token operator">&lt;</span> minTimes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            <span class="token class-name">SitAdvice</span> sitAdvice <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SitAdvice</span><span class="token punctuation">(</span>firstIndex<span class="token punctuation">,</span> getOffFloor<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">if</span> <span class="token punctuation">(</span>first<span class="token punctuation">.</span><span class="token function">getUnusedTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                                sitAdvices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                sitAdvices<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sitAdvice<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                            backAdvices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            backAdvices<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sitAdvice<span class="token punctuation">)</span><span class="token punctuation">;</span>                            minTimes <span class="token operator">=</span> times<span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                        vis<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nextAccess <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">11</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            <span class="token keyword">if</span> <span class="token punctuation">(</span>access<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">||</span> e<span class="token punctuation">.</span><span class="token function">getOpenFloorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                nextAccess<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                        <span class="token punctuation">&#125;</span>                        <span class="token function">dfs</span><span class="token punctuation">(</span>firstIndex<span class="token punctuation">,</span> times <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> start<span class="token punctuation">,</span> destination<span class="token punctuation">,</span> vis<span class="token punctuation">,</span> nextAccess<span class="token punctuation">)</span><span class="token punctuation">;</span>                        vis<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            rlock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>为了实现换乘，笔者自行实现了一个PersonRequest，只是为了加一个nextFloor属性来标志乘客在这部电梯里面应该到哪一个楼层。</p><p>顾名思义getBestElevator返回的是最适合某个请求的电梯。并且在这个方法里面会对请求进行修改，修改的正是请求的nextFloor。getBestElevator的代码含义是：先选取可以直达的电梯（不一定是所有楼层均可达的电梯，只要不用换乘就行）如果有直达的电梯，选择其中unUsedTime最长的电梯作为我们的目标。如果没有可以直达的电梯，则进dfs函数进行路径的寻找。此时我们需要记录的信息是dfs搜索的层数（和换乘的次数有关，记为times），如果是可达路径，那么下电梯的层数nextFloor应该是多少。因此笔者选择在getBestElevator遍历每一部可能可以上的电梯，从它开始进行dfs。在实现dfs的过程中，从dfs的前几行就可以看出，笔者不断地在维护可以换乘的最少次数，当超过这个次数却还没有找到最终路径的话，直接舍弃即可，这样就可以完成剪枝，避免每条路都走到底。最后再从那些最短的路径中选出unUsedTime最长的电梯作为我们的目标。这样的“贪心”模式，不仅可以减少搜索算法的开销，还可以可以保证我们离终点是越来越“近”的，这里近字打了引号是因为近不是指楼层间的距离，而是指换乘次数，因为假设现在要从3楼到2楼，可能唯一的方法是先去11楼换乘另一个能到2楼的电梯。</p><h3 id="结束条件"><a href="#结束条件" class="headerlink" title="结束条件"></a>结束条件</h3><p>由于即使乘客可能无法一次性到达，故本次作业除了maintain可能导致RequestList里面有原有的请求重新加入，还有可能换乘也要重新加入。因此仿造之前的numOfMaintain的信号量机制，这次采用numOfChange表示乘客的数量。其对应的方法除了名称不同之外基本与numOfMaintain对应的方法相同。值得注意的是：对于numOfChange来说，在Input线程接收到一个PersonRequest的时候调用add方法，当乘客到达最终目的地时调用sub方法。并将RequestList的getAndRemove方法中wait的条件改为**requests.isEmpty() &amp;&amp; (!(isOver（表示Input线程是否结束，前面有介绍） == true &amp;&amp; getNumOfChange == 0))**即可，由于这样的情况包括了maintain的情况，故可以不再需要isMaintain。这样就可以使得Distributor线程顺利结束。</p><h2 id="调度策略-1"><a href="#调度策略-1" class="headerlink" title="调度策略"></a>调度策略</h2><p>和Hw6中的LRU算法一致。</p><h1 id="代码优缺点分析与感想"><a href="#代码优缺点分析与感想" class="headerlink" title="代码优缺点分析与感想"></a>代码优缺点分析与感想</h1><h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><p>1.不够灵活，乘客分配到某个电梯的名下就必须只能乘坐这个电梯了，没有周转的余地，除非maintain。<br>2.调度算法不是很好，加入碰到只剩一部完全电梯的情况，其他电梯可能就没有机会被使用了，或者使用的机会很少，仅在那些电梯可以直达的情况才会被使用。<br>3.没有利用java的semaphore信号量机制，选择自己手写，重复造轮子。<br>4.类太多太繁琐，有些代码的功能和名称不完全一样，不完全符合高内聚，低耦合的要求。</p><h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><p>稳健能保证通过且性能不俗，只要不乱优化就不会出任何问题，不容易被特殊数据针对，不会对不同数据表现出极大的性能波动，稳如泰山。</p><h2 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h2><p>优化应该尽力而为，但是可能自己以为的优化并不是贪心优化，并不是每个情况都能做到最好。比如第一次为了把所有的乘客都安排得尽可能“顺路”，导致参数过度优化和过拟合，强测中产生了对某部电梯的过度依赖导致TLE，还不如%6+1，老实本分。Hw7差点没有经得住优化的诱惑，还好OS给足了压力占用了我的时间，使我保留了最初的调度算法，最后得分也让我满意。<br><br><br><br><br><br><br><br><br></p><p>最终UML协作图如下（可能和文字叙述不完全一致，这里的OriginalReqeust指的就是<strong>请求队列</strong>RequestList）<br><img src="/2023/04/12/OO-U2/hw7.png" alt="在这里插入图片描述"></p>]]></content>
      
      
      <categories>
          
          <category> OO </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 多线程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OO-U2-hw1</title>
      <link href="/2023/03/23/OO-U2-hw1/"/>
      <url>/2023/03/23/OO-U2-hw1/</url>
      
        <content type="html"><![CDATA[<h1 id="java多线程设计分析"><a href="#java多线程设计分析" class="headerlink" title="java多线程设计分析"></a>java多线程设计分析</h1><p>初学多线程，在还没有弄明白线程之间为什么要上锁以保证线程安全的时候，容易陷入死锁或者非安全访问的泥沼，本文致力于通过简单的例子说明基于<strong>生产者消费者</strong>模式的多线程协调设计。语文水平有限，语言十分啰嗦，难受的话请跳到最后的总结。</p><h2 id="PPT中的交通管理样例"><a href="#PPT中的交通管理样例" class="headerlink" title="PPT中的交通管理样例"></a>PPT中的交通管理样例</h2><p><img src="/2023/03/23/OO-U2-hw1/p1.png" alt="p1"><br><strong>样例解释</strong>：<br>整个城市可以用一张地图<strong>map</strong>来描述; 地图<strong>map</strong>上有很多道路<strong>road</strong>; 每条道路<strong>road</strong>上有多个车道<strong>lane</strong>; 对于每个车道<strong>lane</strong>，我们都置有一个摄像头<strong>sensor</strong>。<br>摄像头是识别通过车辆的检测器，可以进行对经过的车辆进行数量的统计,并把数据汇报给某个记录数据的单元。</p><p>我们先对<strong>观察者模式</strong>进行一些了解<br>参考出处：<code>作者：虫琏 ； 链接：https://juejin.cn/post/7059310917820874783</code><br><strong>Subject（目标）</strong><br>目标指被观察的对象。在目标中定义了一个观察者集合,它可以存储任意数量的观察者对象,它提供一个接口来增加和删除观察者对象,同时它定义了的通知方法notifyO，告诉观察者状态的变化或具体内容。目标类可以是接口,也可以是抽象类或实现类。</p><p><strong>ConcreteSubject(具体目标)</strong><br>具体目标是目标类的子类,通常它包含经常发生改变的数据，当它的状态发生改变时，向它的各个观察者发出通知。同时它还实现了在目标类中定义的抽象业务逻辑方法（如果有的话）。</p><p><strong>Observer(观察者)</strong><br>观察者将对观察目标的改变做出反应，观察者一般定义为接口,该接口声明了更新数据的方法update(),因此又称为抽象观察者。</p><p><strong>ConcreteObserver(具体观察者)</strong><br>在具体观察者中维护一个指向具体目标对象的引用，它存储具体观察者的有关状态，这些状态需要和具体目标的状态保持一致；它实现了在抽象观察者Observer中定义的update()方法。通常在实现时,可以调用具体目标类的attach()方法将自己添加到目标类的观察者集合中或通过detach()方法将自己从目标类的观察者集合中删除。</p><p>大致关系的类图如下，我们可以把图分为左右两部分，concrete部分实现的是上层的抽象接口，保证可扩展性。左边的每个subject可以被多个右边的observer所观测，右边的observer可以通过getState方法获取左侧subject的状态信息。</p><p>在关系中不难看出，Subject对Observer的关系是一对多或者一对一的，使用了observers容器来储存，中间方框内的遍历使用update()方法就是告诉Subject的每一个Observer状态的变更情况。<br><img src="/2023/03/23/OO-U2-hw1/p2.png" alt="p2"></p><p><br><br><br>课程组也给了我们一个初步的类图和亿些代码以及文字提示，先从类图开始研究一番<br><img src="/2023/03/23/OO-U2-hw1/p3.png" alt="p3"><br><br><br><br><img src="/2023/03/23/OO-U2-hw1/p4.png" alt="p4"><br>根据之前所描述的观察者模式，不难看出，这里的被观测对象是TrafficSensor, 观察者是TrafficController。从我们的生活经验上来看，来往的车辆是我们的观察对象，但是在代码中我们无法直接模拟车辆，因此我们观察的对象被封装为摄像头反馈的车辆信息。</p><p>在图中我们发现Subject对Observer是一对一的关系。每一个TrafficSensor存有对应的TrafficController，并且有自己的车道编号laneNo。当TrafficSensor检测到车辆通过时，就会调用TrafficController的vehiclePassed()方法，这里的vehiclePassed方法也就对应了之前我们提到的该模式下一般性的Update()方法。每一个TrafficSensor都是一个独立的线程，将信息提供给Controller。TrafficSensor代码如下</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TrafficSensor</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> laneNo<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">TrafficObserver</span> obs<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">TrafficSensor</span><span class="token punctuation">(</span><span class="token keyword">int</span> lane<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        laneNo <span class="token operator">=</span> lane<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setObserver</span><span class="token punctuation">(</span><span class="token class-name">TrafficObserver</span> obs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>obs <span class="token operator">=</span> obs<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            obs<span class="token punctuation">.</span><span class="token function">vehiclePassed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">try</span><span class="token punctuation">&#123;</span>                <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>注：这里模拟得十分僵硬，相当于每隔0.1s就会来一辆车，有要求的同学可以改成Math.random()*1000等具有随机性的值，使得程序更加贴近真实。</code></p><p>我们接着分析TrafficController,  其属性包括存储观察信息的int vehicleCount和道路编号int RoadNo，以及系统读取的周期数int cycle。在除了构造方法和vehiclePassed方法以及单纯获取RoadNo的readRoad方法之外，该方法还有getAndClearCount()方法，从名字可以发现，该方法会清空vehicleCount中的数值，并且返回之前累积的值。我们不难发现，这个观察者类其实是一种容器，容器内含有两种方法，一种是往里累加信息的方法，一种是重置并返回（取出）容器内信息的方法，且这两种方法都是供外界调用。加上PPT上醒目的<strong>生产者-消费者</strong>的线程交互模式，我们得以了解到，除了观察者和被观查者的角度分析外，TrafficSenor是生产者，TrafficController是“托盘”，调用vehicleCount方法的对象是消费者。</p><p>附上TrafficController代码和TrafficObserver接口代码(cycle属性没放里面)，作为公共资源，对vehicleCount访问或者修改的代码需要上锁。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TrafficObserver</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">vehiclePassed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TrafficController</span> <span class="token keyword">implements</span> <span class="token class-name">TrafficObserver</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> vehicleCount<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> roadNo<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> cycle <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">TrafficController</span><span class="token punctuation">(</span><span class="token keyword">int</span> road<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        roadNo <span class="token operator">=</span> road<span class="token punctuation">;</span>        vehicleCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">vehiclePassed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//all sensors will call</span>        vehicleCount <span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">getAndClearCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//only the reporter will call</span>        cycle <span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> cur_count <span class="token operator">=</span> vehicleCount<span class="token punctuation">;</span>        vehicleCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"vehicle passed:"</span> <span class="token operator">+</span> cur_count <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token string">"in road:"</span> <span class="token operator">+</span> roadNo <span class="token operator">+</span><span class="token string">" "</span><span class="token operator">+</span> <span class="token string">"for the cycle: "</span> <span class="token operator">+</span> cycle<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> cur_count<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">readRoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> roadNo<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><br><br><br>通过第二个类图和课程组提供的代码我们不难发现，调用getAndClearCount方法的正是TrafficReporter类。通过属性，我们发现每个TrafficReporter类对应了一个TrafficController，”消费“其中的信息。顾名思义，TrafficReporter类肯定要向某个单位汇报目前所得的信息，这又是一个独立的线程。至此，我们已经通过一个基本的生产者-消费者模型完成了信息链的初步传递。如下图所示，1条road中的n个lanes对应n个Sensor，1个Controller和一个Reporter。Sensor将信息存在Controller里面，Report读取并清空信息反馈给map。</p><p><img src="/2023/03/23/OO-U2-hw1/p5.png" alt="p5"></p><p>代码如下</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TrafficReporter</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">TrafficController</span> controller<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">TrafficMap</span> map<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> period<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">TrafficReporter</span><span class="token punctuation">(</span><span class="token class-name">TrafficController</span> trc<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        period <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>        controller <span class="token operator">=</span> trc<span class="token punctuation">;</span>        map <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">ConfigMap</span><span class="token punctuation">(</span><span class="token class-name">TrafficMap</span> tmap<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        map <span class="token operator">=</span> tmap<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>period<span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">int</span> count <span class="token operator">=</span> controller<span class="token punctuation">.</span><span class="token function">getAndClearCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">int</span> road <span class="token operator">=</span> controller<span class="token punctuation">.</span><span class="token function">readRoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>road<span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>注意：我们发现Sensor含有的Controller和Reporter含有的map都有对应的set或者config方法，而不是在构造函数中一蹴而就，这给后续可能的扩展或者相应对象更换带来了便利</code></p><p><br><br><br>对TrafficMap进行分析，直接从代码入手。可以发现TrafficMap的主体是一个HashMap，也是一个”托盘”, 其对应的生产者是之前调用TrafficMap.put方法的TrafficReporter。其对应的消费者则是全局性管理的Manager（肯定会调用get）方法。<br>因此，TrafficMap也是一个公共资源，记得上锁。注意并不是总记录了所有的road信息，对于已经被读取完的road, 会被remove, put时进行重建或累加。请细细品味notify和wait的使用（前提是有锁才需要等待，故wait必须放在synchronized块里）。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TrafficMap</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> traffic<span class="token punctuation">;</span>    <span class="token class-name">TrafficMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>traffic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token keyword">int</span> road<span class="token punctuation">,</span> <span class="token keyword">int</span> vcount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Integer</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>road<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>traffic<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            traffic<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>traffic<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>vcount<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"record added into map: (road "</span><span class="token operator">+</span>r<span class="token operator">+</span><span class="token string">", vehicle passed count "</span><span class="token operator">+</span>traffic<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>vcount<span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            traffic<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>vcount<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"record added into map: (road "</span><span class="token operator">+</span>r<span class="token operator">+</span><span class="token string">", vehicle passed count "</span><span class="token operator">+</span>vcount<span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> road<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Integer</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span> <span class="token punctuation">(</span>road<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>traffic<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">Integer</span> t <span class="token operator">=</span> traffic<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>        traffic<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"record fetched from map: (road "</span><span class="token operator">+</span>r<span class="token operator">+</span><span class="token string">", vehicle passed count "</span><span class="token operator">+</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> t<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><br><br><br>Manager类作为一个单独的线程，独立地提取出map中的数据并做出后续可能的处理，如color等。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Manager</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">TrafficMap</span> map<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> roadMAX <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>                         <span class="token comment">// it's 1000 originally, determined by yourself</span>    <span class="token class-name">Manager</span><span class="token punctuation">(</span><span class="token class-name">TrafficMap</span> tmap<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        map <span class="token operator">=</span> tmap<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> count<span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> r <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> r <span class="token operator">&lt;</span> roadMAX<span class="token punctuation">;</span> r<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                count <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"mgr received: (road: "</span> <span class="token operator">+</span> r <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> <span class="token string">"vehicle passed count: "</span> <span class="token operator">+</span> count <span class="token operator">+</span><span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//roadColoring(r, count);</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>roadcolor我认为是和某些地图上一样对不同的拥堵段上色，这个属于额外功能，不是本章的重点，在这里就不实现了。我只实现了3条road，每条road2个lane的设计，如下所示。我并没有模拟不同路段的概率等，且由于sensor没有终止功能，程序会一直运行，此程序即为僵硬，笔者时间和水平有限，见谅</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainClass</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TrafficController</span><span class="token punctuation">></span></span> trafficControllers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TrafficReporter</span><span class="token punctuation">></span></span> trafficReporters<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">TrafficMap</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TrafficMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span><span class="token number">3</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">TrafficController</span> trafficController <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TrafficController</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>            trafficControllers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>trafficController<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">TrafficSensor</span> trafficSensor1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TrafficSensor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            trafficSensor1<span class="token punctuation">.</span><span class="token function">setObserver</span><span class="token punctuation">(</span>trafficController<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">TrafficSensor</span> trafficSensor2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TrafficSensor</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            trafficSensor2<span class="token punctuation">.</span><span class="token function">setObserver</span><span class="token punctuation">(</span>trafficController<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Thread</span> sensor1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>trafficSensor1<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Thread</span> sensor2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>trafficSensor2<span class="token punctuation">)</span><span class="token punctuation">;</span>            sensor1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            sensor2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">3</span> <span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">TrafficReporter</span> trafficReporter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TrafficReporter</span><span class="token punctuation">(</span>trafficControllers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            trafficReporters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>trafficReporter<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name"><span class="token namespace">trafficReporter<span class="token punctuation">.</span></span>ConfigMap</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Thread</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>trafficReporter<span class="token punctuation">)</span><span class="token punctuation">;</span>            producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">Manager</span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Thread</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>manager<span class="token punctuation">)</span><span class="token punctuation">;</span>        consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>总结（省流版）</strong>：<br>该模型用到了<strong>两对</strong>生产者消费者模型，其中TrafficReporter既作为消费者不断掏空Controller中存储的数据，又作为生产者不断将数据put进map中，使得manager可以及时提取并做出全局性操作。设计两对的目的是将信息从每条lane上封装到road,再从road集中到map，设计极为巧妙，使用reporter进行过渡连接。不过<strong>观察者模式</strong>在这里体现得还没有那么突出，毕竟是一对一的调用。另外，sensor,reporter和manager三种线程之间sleep的间隔可以自由设置，互不干扰，实现了“并行化处理”。</p><p>在coding中，我们可以发现，对于多线程设计来说，最重要的就是保护临界资源。而对于本例和hw5中所使用的到<strong>生产者-消费者模式</strong>，需要上锁的临界区对象就是“托盘”，<strong>”托盘“类中一般附有两种public方法，一种是填入，一种是取出并清空，填入由生产者线程调用，取出并清空由消费者线程调用。使用的时候对这两种方法进行synchronized的简单上锁即可。</strong> 此外，由于存在清空操作，故取出的时候不要忘记判断isEmpty,如果容器为空，请进入wait状态，待存入时在结尾notifyAll进行提醒。<strong>在这个例子中，我们可以发现第一个托盘TrafficController里的容器vehicleCount是可变长无上限(如果有的话也是int的上限)有下限（0）的缓冲（临界）区，因此在放入时候不用考虑是否会放满而需要while(isFull){wait}, 清空的时候由于没有车辆通过时可以直接返回0，也不需要考虑是否取不出东西而while(isEmpty){wait}。 因此也就不存在notifyAll()的需要。而TrafficMap中的HashMap也是可变长无上限有下限(Empty)的容器，但是由于取出是通过remove进行的，故需要containsKey()预先进行判断，如果没有，表示用户现在需要获取这条道路的信息，等到对应road上的reporter将信息存入之后，再在Put方法的最好用notifyAll()唤醒该线程，使得其继续进行操作，这一点很重要，不应该被忘记。相应地get方法就不需要NotifyAll了</strong></p><p><br><br></p><h2 id="Hw5作业架构拙见"><a href="#Hw5作业架构拙见" class="headerlink" title="Hw5作业架构拙见"></a>Hw5作业架构拙见</h2><p>根据指导书中要求以及和输入输出接口的提示，我们发现读入的每一个乘客信息是我们生产和消费的基本单位。读入部分（乘客发出请求）是信息的生产者（生产线程），电梯（接受并处理乘客的需求）是消费者。而中间相应地也需要一个”托盘”来存放乘客请求信息，这就是指导书中建议的<strong>候乘表类</strong>。这里的结构与PPT案例中的reporter-map-manager的部分有些许类似，只不过那里是多个reporter,1个map,1个manager。此次作业是1个requestInputUnit,6个候乘表类,6个Elevator。</p><p>另外，对于消费的过程，其实当乘客上到电梯里就已经结束了，因为我们从候乘类表中让乘客进入电梯里就已经将候乘类表对应的容器进行了remove操作，这里在取出的时候可能需要判断,但是不能直接wait，否则电梯里有人的话电梯仍应该继续运行，wait另有其可能；但是存入的时候需要直接notifyAll()，让空闲电梯进入工作。</p><p>hw5难度其实并不在多线程设计<strong>生产者-消费者模型</strong>本身，而在于：</p><p>1个requestInputUnit到6个候乘表类的映射和选择，中间可以插入一个选择类进行分析。当然这部分也可以不做，直接%6轮流上即可,相信概率论的伟力 <del>（对于我这样水平中等的同学天天卷这方面非架构类的东西不如享受生活，毕竟还有很多比分数更重要的人和事）</del>。</p><p>电梯把乘客从候乘表类放到电梯内之后应该上下开门关门进入出入与否的调度，这里才是最难实现最容易出错的地方，坐等欣赏各位大佬各显神通。</p><h2 id="测试建议"><a href="#测试建议" class="headerlink" title="测试建议"></a>测试建议</h2><p>1.高频反向接人(测试strategy正确性)<br>2.大客流量一次性投入(测试电梯容纳上限6人正确性)<br>3.大客流量分批不同楼层投入(测试tle与否)<br>4.压线数据+大客流量投入(投入时间卡在50s)左右</p><h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>尽吾志也而不能至者，可以无悔矣，其孰能讥之乎？希望本文能给同学们带来帮助。</p>]]></content>
      
      
      <categories>
          
          <category> OO </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 多线程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OO_unit1</title>
      <link href="/2023/02/21/OO-unit1/"/>
      <url>/2023/02/21/OO-unit1/</url>
      
        <content type="html"><![CDATA[<h1 id><a href="#" class="headerlink" title></a></h1><p>面向过程的编程单位：函数</p><p>确定性的输入可以得到确定性的输出 != 相同的输入得到相同的输出</p><p>java只能单继承，但是可以多实现(implement)</p><p>String 是一个不可变对象，其相应的所有方法都是重新构造一个新的对象并指向它</p><p>编程习惯：如果写了有参构造，记得显式地写出无参构造</p><p>纪老师邮箱 <a href="mailto:&#53;&#x39;&#57;&#48;&#51;&#x38;&#57;&#x40;&#113;&#113;&#x2e;&#x63;&#x6f;&#x6d;">&#53;&#x39;&#57;&#48;&#51;&#x38;&#57;&#x40;&#113;&#113;&#x2e;&#x63;&#x6f;&#x6d;</a></p><h1 id="OO-Unit1"><a href="#OO-Unit1" class="headerlink" title="OO-Unit1"></a>OO-Unit1</h1><h2 id="代码架构分析"><a href="#代码架构分析" class="headerlink" title="代码架构分析"></a>代码架构分析</h2><h2 id="homework1-无穷层括号嵌套也支持"><a href="#homework1-无穷层括号嵌套也支持" class="headerlink" title="homework1 (无穷层括号嵌套也支持)"></a>homework1 (无穷层括号嵌套也支持)</h2><pre><code>根据hw1的需求分析，我们可以将任务划分为三个部分：递归下降读入并构建表达式树；将表达式展开（去括号）；合并同类项与优化。以第三次作业架构画类图如下</code></pre><p><img src="https://img-community.csdnimg.cn/images/3a8ece16d8ad4b1b8a9486b40ac5ad44.png" alt="img" title="#left"></p><h3 id="一-递归下降读入并保存表达式"><a href="#一-递归下降读入并保存表达式" class="headerlink" title="一.递归下降读入并保存表达式"></a>一.递归下降读入并保存表达式</h3><h4 id="0-预处理"><a href="#0-预处理" class="headerlink" title="0.预处理"></a>0.预处理</h4><p>本设计中只进行了空白符的预处理，没有对正负符号进行分别的判断和处理</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">deleteEmpty</span><span class="token punctuation">(</span><span class="token class-name">String</span> raw<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> len <span class="token operator">=</span> raw<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token class-name">StringBuilder</span> res <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>pos <span class="token operator">&lt;</span> len<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>raw<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                pos<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                res<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>raw<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                pos<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-词法分析器Lexer"><a href="#1-词法分析器Lexer" class="headerlink" title="1.词法分析器Lexer"></a>1.词法分析器Lexer</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java">    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Lexer</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> input<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> curToken<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Lexer</span><span class="token punctuation">(</span><span class="token class-name">String</span> input<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>input <span class="token operator">=</span> input<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">validpos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>pos <span class="token operator">&lt;</span> input<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getTriFuc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>pos <span class="token operator">&lt;</span> input<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"sincos"</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token operator">++</span>pos<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>pos <span class="token operator">&lt;</span> input<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">isDigit</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token operator">++</span>pos<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>pos <span class="token operator">==</span> input<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">char</span> c <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">isDigit</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            curToken <span class="token operator">=</span> <span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"sincos"</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            curToken <span class="token operator">=</span> <span class="token function">getTriFuc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            pos <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>            curToken <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>curToken<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">char</span> <span class="token function">charatPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> input<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre><code>由于x,y,z均为len=1的变量，故处理起来十分方便，而数字可能是2位数及以上的，故需要专门的getNumber方法。curToken是我们目前读到的具有整体性意义的有效字符串，从Lexer的构造方法中可以看出，Lexer.next()方法是读取下一个有效字符串的方法，而pos指向的是待读入的下一个字符的位置。初始化时我们读了第一个整体性字符串，pos指向下一个待读取的字符。这里有两个地方值得引起注意：1.Lexer.next()中首先判断了pos的位置，如果pos到len处了，说明读入已经结束，返回即可。2.pos永远+=1,且没有出现在循环体中重复+不为1的值，即没有出现较大的跃度，这样可以使得代码美观，具有一致性，且不易出错（尤其是跳到越界处）。</code></pre><p><br><br><br><br><br></p><h4 id="2-解析器Parser"><a href="#2-解析器Parser" class="headerlink" title="2.解析器Parser"></a>2.解析器Parser</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Parser</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Lexer</span> lexer<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Parser</span><span class="token punctuation">(</span><span class="token class-name">Lexer</span> lexer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>lexer <span class="token operator">=</span> lexer<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Expr</span> <span class="token function">parseExpr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Expr</span> expr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Expr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">)</span> <span class="token operator">||</span> lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> sign <span class="token operator">=</span> lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            lexer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            expr<span class="token punctuation">.</span><span class="token function">addTerm</span><span class="token punctuation">(</span><span class="token function">parseTerm</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            expr<span class="token punctuation">.</span><span class="token function">addTerm</span><span class="token punctuation">(</span><span class="token function">parseTerm</span><span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">)</span> <span class="token operator">||</span> lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> sign <span class="token operator">=</span> lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            lexer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            expr<span class="token punctuation">.</span><span class="token function">addTerm</span><span class="token punctuation">(</span><span class="token function">parseTerm</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> expr<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Term</span> <span class="token function">parseTerm</span><span class="token punctuation">(</span><span class="token class-name">String</span> sign<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Term</span> term <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Term</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>sign<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            term<span class="token punctuation">.</span><span class="token function">addFactor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">"-1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            term<span class="token punctuation">.</span><span class="token function">addFactor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">"-1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            lexer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            term<span class="token punctuation">.</span><span class="token function">addFactor</span><span class="token punctuation">(</span><span class="token function">parseFactor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            lexer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            term<span class="token punctuation">.</span><span class="token function">addFactor</span><span class="token punctuation">(</span><span class="token function">parseFactor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            term<span class="token punctuation">.</span><span class="token function">addFactor</span><span class="token punctuation">(</span><span class="token function">parseFactor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            lexer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            term<span class="token punctuation">.</span><span class="token function">addFactor</span><span class="token punctuation">(</span><span class="token function">parseFactor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> term<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Factor</span> <span class="token function">parseFactor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"("</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token function">paserPowExpr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ToolFuctions</span><span class="token punctuation">.</span><span class="token function">isVar</span><span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token function">parserVar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"sin"</span><span class="token punctuation">)</span> <span class="token operator">||</span> lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"cos"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token function">parserTriFuc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"fgh"</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token function">parserFuction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token function">parserDerivative</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token function">parserInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Number</span> <span class="token function">parserInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">)</span> <span class="token operator">||</span> lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> sign <span class="token operator">=</span> lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            lexer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> tempnum <span class="token operator">=</span> sign <span class="token operator">+</span> lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">BigInteger</span> num <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span>tempnum<span class="token punctuation">)</span><span class="token punctuation">;</span>            lexer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">BigInteger</span> num <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            lexer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Factor</span> <span class="token function">parserVar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> <span class="token keyword">var</span> <span class="token operator">=</span> lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        lexer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">charatPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'*'</span> <span class="token operator">&amp;&amp;</span> lexer<span class="token punctuation">.</span><span class="token function">validpos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            lexer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            lexer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                lexer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">int</span> poly <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            lexer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>poly <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PowVar</span><span class="token punctuation">(</span><span class="token keyword">var</span><span class="token punctuation">,</span> poly<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token class-name">BigInteger</span><span class="token punctuation">.</span><span class="token constant">ONE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PowVar</span><span class="token punctuation">(</span><span class="token keyword">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Factor</span> <span class="token function">parserTriFuc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> kind <span class="token operator">=</span> lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        lexer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//读完sin/cos去读下一个</span>        lexer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//读取完左括号</span>        <span class="token class-name">Factor</span> factor <span class="token operator">=</span> <span class="token function">parseFactor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//执行完之后peek已经是右括号</span>        lexer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 去读取右括号的下一个内容</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">charatPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'*'</span> <span class="token operator">&amp;&amp;</span> lexer<span class="token punctuation">.</span><span class="token function">validpos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            lexer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            lexer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                lexer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">int</span> poly <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            lexer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>poly <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TriFuc</span><span class="token punctuation">(</span>kind<span class="token punctuation">,</span> factor<span class="token punctuation">,</span> poly<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token class-name">BigInteger</span><span class="token punctuation">.</span><span class="token constant">ONE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TriFuc</span><span class="token punctuation">(</span>kind<span class="token punctuation">,</span> factor<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由于没有做符号的预处理部分，读入可以保证绝对的方便和正确，但故对于正负号的判断比较复杂，在最初的设计中，除了Number可以带符号之外，只有Term有符号，且Term的符号)最终是由Term前面的符号(分析Expr时候得出的)和Term中Number的符号共同决定的，这样的方式很容易导致错误和处理的不一致。在后续的设计中，我取消了Number和Term的符号，选择直接加入一个值为-1的Number作为Term的factor,使得符号的设计具有一致性，起到解耦合的作用。</p><p><br><br><br>除term外，实现Factor的类型有：Expr(无幂次和符号属性),Number(数),PowVar(幂因子),PowExpr(表达式因子，由内容Expr和幂次pow组成，这个类是中间类，在降幂处理后就不存在了)</p><p>至此，我们实现了表达式树的构建。</p><h3 id="二-将带括号的表达式展开"><a href="#二-将带括号的表达式展开" class="headerlink" title="二.将带括号的表达式展开"></a>二.将带括号的表达式展开</h3><h4 id="1-消除PowExpr"><a href="#1-消除PowExpr" class="headerlink" title="1.消除PowExpr"></a>1.消除PowExpr</h4><pre><code>写出两个判断实例中容器是否满足所有子表达式项均&lt;=1的函数isLowerstPow(term or expr)。对于term的实例，遍历factors，如果factors中有ExprPoW,对ExprPoW进行拆分或剪枝优化(优化部分最后有介绍)，注意，这里要对ExprPow中的Expr进行彻底的深拷贝，否则会出现两个引用实例指向同一内存空间的错误；如果有Expr，进一步调用Expr的判断函数；对于Expr的判断函数则是遍历terms，调用terms的判断函数。</code></pre><h4 id="2-递归实现表达式乘法展开"><a href="#2-递归实现表达式乘法展开" class="headerlink" title="2.递归实现表达式乘法展开"></a>2.递归实现表达式乘法展开</h4><pre><code>对于最初的实现方式：如果是两个expr相乘，拆出各自expr中的每一个term，由两层循环遍历将两个term组合成一个新的term,放入待返回的新的expr中的terms里。如果只有一个expr,则将此expr的每个term添加上除它之外的其他term中的factors即可(仍需要深拷贝)。但是这样会造成问题，就是虽然括号得以展开，却会大量出现term中有且只有一个expr的情况，表达式树仍然不是最简的情况。类似于堆排序维护的DFS递归简化expr对目前所得到的所有Expr中的terms里的每一个Term进行分析，如果该Term中含有Expr，则该Term只含有一个Expr，没有其余factor，即Term。getfactors.size()==1 &amp;&amp; Term.getfactors.size().get(0) instanceof Expr==true；否则Term中含有的都是不属于Expr的最简单factor(常数和幂函数)。因此我们可以进行DFS递归来使得表达式树的层数不断下降至1(最简)。递归方式如下：首先写两个函数判断expr和term是否已经化至最简。对term来说，遍历factors,由之前分析可知，如果Term.getfactors.size()==1 &amp;&amp; Term.getfactors.size().get(0) instanceof Expr==true，即term中只含有一个expr的情况，这时候只需要把expr中terms的每一个都放入包含该term的Expr中的terms即可;而对于expr来说，遍历terms,如果出现包含expr的term，则递归调用上述化简term的函数。</code></pre><p><br><br></p><pre><code>在第二次上机之后获得启发后的改良：不管乘法的对象是几个expr，先new一个expr，最后返回此expr。首先遍历expr中的terms，对每一个term进行处理。对term的处理则是遍历factors的每一个factor,记录是否有expr。如果有则返回true并记录expr的下标；反之，返回false。如果函数中不存在expr的项，则深拷贝一份term,将其加入最开始new的expr中，返回此expr即可。否则，遍历factors,将之前找到的factors中的expr中的每一个term加上factors中的其余项(仍然需要深拷贝)。最后对该expr重复进行expr的去括号操作，最后返回一个terms中的每一个term不包含expr的表达式。最后返回第一层对expr的每一个term的处理，由于返回的都是expr，故只需要各个返回的expr合并即可。这样一来，我们便可以省去之前DFS递归简化expr的情况，因为每一次操作我们都合并了expr，就不会产生某个Term只包含expr的情况。</code></pre><p>至此，已经获得了一个性能不太好的正确结果。<br><br><br><br><br><br></p><h3 id="三-合并同类项与性能优化"><a href="#三-合并同类项与性能优化" class="headerlink" title="三.合并同类项与性能优化"></a>三.合并同类项与性能优化</h3><h4 id="基础优化"><a href="#基础优化" class="headerlink" title="基础优化"></a>基础优化</h4><h5 id="1-合并同类项"><a href="#1-合并同类项" class="headerlink" title="1.合并同类项"></a>1.合并同类项</h5><pre><code>新增一个类Item,属性包含系数coef,x,y,z的幂polyX,polyY,polyZ。遍历我们得到的初步正确答案(expr)，由递归下降部分可知，最终的expr里面的terms容器中的term中不含有属于expr类的factor。故我们可以根据加号和减号分隔开每一项(term)，并为它们每一个都实例化Item，并装入items容器(Arraylist即可)。最后遍历容器，可以写一个辅助函数判断xyz幂次是否完全相同，如果完全相同，则系数(coef)合并。</code></pre><h5 id="2-零一优化"><a href="#2-零一优化" class="headerlink" title="2.零一优化"></a>2.零一优化</h5><pre><code>对于每个Item,有如下几种情况。首先，系数为0，直接不输出。其次，xyz幂次均为0，此时只要输出系数即可；再次，判断系数绝对值是否为1.如果为1，则不输出系数，只输出符号。如果不为1，则输出系数。对于幂次的输出，按照xyz的顺序，如果未输出系数，则输出x * * n,反之，输出* x * * n。对于y,z同前，如果x幂次为0则不输出x，对于y而言同前，否则输出* y * * n。由于前面一直忽略了0，故最后结果如果为空串，输出0。</code></pre><p><br><br></p><h4 id="进阶优化"><a href="#进阶优化" class="headerlink" title="进阶优化"></a>进阶优化</h4><p>1.符号优化<br>   如果同时有+和-号，第一项输出+号项，但是无需输出+号；如果没有+号则不优化；如果只有+号，则只去掉第一项的+。</p><p>2.平方优化<br>    如果xyz有平方项，原本输出x * * 2改为x * x。<br><br><br></p><h4 id="剪枝优化"><a href="#剪枝优化" class="headerlink" title="剪枝优化"></a>剪枝优化</h4><pre><code>1.term中factors若含有0，直接找到该term所在的terms容器，移除term。如果有1则将1从factors里面移除。2.在降幂的时候如果有0次幂，直接new Num(1)取代。</code></pre><h2 id="homework2-增加自定义函数和三角函数"><a href="#homework2-增加自定义函数和三角函数" class="headerlink" title="homework2 (增加自定义函数和三角函数)"></a>homework2 (增加自定义函数和三角函数)</h2><pre><code>由于第一次已经实现了多重括号的支持，所以第二次作业相对来说任务不会太多。其实只有两个任务：1.把自定义函数转化成三角函数。2.把三角函数内部进行化简。我们首先进行第二个任务，默认自定义函数已经全部转化为了三角函数，具体原因暂时不介绍。这里只需要对三角函数内部进行讨论即可，如果不是expr，则我们不需要额外处理；如果是expr，我们只需要把三角函数内部的expr也看成这次作业的目标即可，在递归的时候对三角函数进行额外的instanceof讨论，然后将其内部的expr在递归时重新调用expr相关的处理方法即可。然后我们进行第一个任务，目前我们已经可以做到无自定义函数的正确处理，那对于自定义函数，我们只需要将传入的参数看作一个expr，再将其中的PowVar替换成对应的PowExpr即可(注意深拷贝)。具体实现是将我们目前实现的功能对自定义函数的表达式进行解析（这就解答了为什么我们先做第二个任务，因为自定义函数中不会递归调用自己）。生成表达式树之后将有关的PowVar替换成PowExpr，最后把自定义函数替换成expr因子，替换待计算表达式的自定义函数因子即可，第二次作业就这样也得到了初步完成。不考虑三角函数化简的情况下，化简同上。</code></pre><h2 id="homework3-增加导数和自定义函数的非递归相互调用"><a href="#homework3-增加导数和自定义函数的非递归相互调用" class="headerlink" title="homework3 (增加导数和自定义函数的非递归相互调用)"></a>homework3 (增加导数和自定义函数的非递归相互调用)</h2><pre><code>自定义函数的非递归相互调用部分十分简单，只需要按顺序执行即可。对于导数而言，由于只出现一次，所以我们只需要对求导函数进行一次处理即可。注意乘法公式和链式法则，注意深拷贝。</code></pre><h2 id="程序Bug"><a href="#程序Bug" class="headerlink" title="程序Bug"></a>程序Bug</h2><p>仅在第二次作业中优化三角函数时产生了sin(-x)缺少一层括号的失误。</p><h2 id="发现他人Bug的策略"><a href="#发现他人Bug的策略" class="headerlink" title="发现他人Bug的策略"></a>发现他人Bug的策略</h2><pre><code>1.联合测试    将各种类型的bug糅合在一起，常见的有：    为了优化三角函数括号层数导致sin(-x)没加括号。    为了优化x**2-&gt;x*x导致三件函数sin(x*x)没加括号    sin(0)**0,cos(0)**0,(表达式内为0)**0    复合函数求导2.使用评测机3.用自己在调试过程中产生过的hack点</code></pre><h2 id="程序性能与优缺点分析"><a href="#程序性能与优缺点分析" class="headerlink" title="程序性能与优缺点分析"></a>程序性能与优缺点分析</h2><p><img src="https://img-community.csdnimg.cn/images/d94929ae8f3e4998b893a47c5f94f0cf.png" alt="img" title="#left"></p><p><img src="https://img-community.csdnimg.cn/images/5cfddd0ca7f44177af81c1eeafbd0b47.png" alt="img" title="#left"></p><pre><code>方法之间的耦合度过高，Term类中的方法复杂度太大。有很多类都是中间类，最后不会得到保存。类的合并太少，每次迭代需要更新的代码量较大。此外，对于一些方法的递归调用使用了判断来保证结果的正确性，这会导致栈的深度十分难以接受，对性能影响极大，容易造成Memory out of bound或者TLE。</code></pre><h2 id="心得体会"><a href="#心得体会" class="headerlink" title="心得体会"></a>心得体会</h2><pre><code>1.递归下降程序在编写的时候在expr层面都是比较容易的，具体落实到term或者factor的处理上才会有相对较大的代码量，因此对于每个功能的封装显得格外重要，不同功能之间应该避免过多的耦合，这样代码阅读和调试的难度会很大2.尽量使用评测机测出Bug,保证基本的正确分可以拿到，至于优化可以尽力而为。3.toString方法尽量不要去产生某些量的修改，否则debug时可能会自动调用导致一些意想不到的Bug4.注意深拷贝5.多看讨论区，以谦虚的姿态学习他人的代码思想和风格；在力所能及的情况下帮助他人debug</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> OO </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OS引论，开机与系统引导</title>
      <link href="/2023/02/20/OS-Unit1/"/>
      <url>/2023/02/20/OS-Unit1/</url>
      
        <content type="html"><![CDATA[<h1 id="第一单元理论"><a href="#第一单元理论" class="headerlink" title="第一单元理论"></a>第一单元理论</h1><h2 id="操作系统的基本特点"><a href="#操作系统的基本特点" class="headerlink" title="操作系统的基本特点"></a>操作系统的基本特点</h2><h3 id="操作系统的定义"><a href="#操作系统的定义" class="headerlink" title="操作系统的定义"></a>操作系统的定义</h3><p>控制和管理整个计算机系统的<strong>硬件与软件资源</strong>，合理地组织、调度计算机的工作与资源的分配，进而为用户和其他软件提供方便接口与环境的程序集合。<br>操作系统是<strong>计算机系统中最基本的系统软件</strong>（缩句：操作系统是软件）。</p><p>课上PPT总结：OS 对上提供接口和虚拟机，对下（硬件）控制计算机资源</p><h3 id="操作系统的基本特征"><a href="#操作系统的基本特征" class="headerlink" title="操作系统的基本特征"></a>操作系统的基本特征</h3><p>共有四个基本特征，其中<strong>并发</strong>和<strong>共享</strong>是操作系统<strong>最基本</strong>的特征，且二者互为存在的条件。 没有并发就不需要共享，没有共享就无法实现并发。</p><h4 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h4><h5 id="并发与并行的区别"><a href="#并发与并行的区别" class="headerlink" title="并发与并行的区别"></a>并发与并行的区别</h5><p>并发：同一时间间隔（一段时间）内，计算机系统中同时存在多个运行的程序，宏观上“同时”执行多个程序，实质是快速切换地交替执行（渣男）<br>并行：同一时刻（一个瞬间），真正的同时执行多个程序 （超人）</p><h4 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h4><p>并发微观上仍然是分时交替进行的，通过<strong>分时</strong>得以实现；并行则需要硬件支持，如<strong>多流水线或多处理机硬件环境</strong>。</p><h4 id="共享"><a href="#共享" class="headerlink" title="共享"></a>共享</h4><p>指的是资源共享，即系统中的资源可供内存中多个并发执行的进程共同使用。有如下两种共享方式</p><h5 id="互斥共享方式"><a href="#互斥共享方式" class="headerlink" title="互斥共享方式"></a>互斥共享方式</h5><p>打印机等资源虽然可以供多个进程使用，但是一段时间只允许一个进程访问该资源。我们定义：一段时间内只允许一个进程访问的资源称为<strong>临界资源</strong>。对临界资源的共享方式，我们称之为互斥共享。例如资源B处于空闲时，A进程请求使用B资源，请求成功。此时C资源如果要使用B资源，要等到A进程使用完并主动释放资源B为止(突出的是使用的连续性，不可被中断性)。</p><h5 id="同时访问方式"><a href="#同时访问方式" class="headerlink" title="同时访问方式"></a>同时访问方式</h5><p>宏观上的“同时”，微观上仍然可能是交替访问。与互斥共享方式不同的是，同时访问可以将一个请求分为几个时间片间隔地完成（非连续性）。如磁盘设备就是典型的可供多个进程同时访问的资源。</p><h4 id="虚拟"><a href="#虚拟" class="headerlink" title="虚拟"></a>虚拟</h4><p>把物理实体抽象成逻辑上的对应物（逻辑上就是表观上，造成一种“假象”）。</p><h4 id="时分复用技术"><a href="#时分复用技术" class="headerlink" title="时分复用技术"></a>时分复用技术</h4><p>使得同一时间每个用户都感觉自己独占某个资源。<br>例如<strong>虚拟处理器技术</strong>：通过多道程序设计技术，采用并发执行的方法，分时使用<strong>一个</strong>CPU，“同时”服务于多个用户，使得每个用户感觉有一个CPU专门为之服务。</p><h4 id="空分复用技术"><a href="#空分复用技术" class="headerlink" title="空分复用技术"></a>空分复用技术</h4><p>使得用户感觉到的（认为可以使用的）资源容量大于资源的实际物理容量。<br>例如<strong>虚拟存储器技术</strong>：通过换入换出（替换），覆盖等技术逻辑上扩充内存容量。</p><h4 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h4><h5 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h5><p>由于<strong>并发性</strong>的存在和<strong>资源有限的制约</strong>，进程的执行不可能“一气呵成”，而是走走停停，且以不可预知的速度向前推进。这样的现象成为异步性。</p><h4 id="异步和程序确定性的非矛盾性"><a href="#异步和程序确定性的非矛盾性" class="headerlink" title="异步和程序确定性的非矛盾性"></a>异步和程序确定性的非矛盾性</h4><p>异步性使得操作系统运行在一种随机的环境下，这可能导致时序错误，只要运行环境相同，操作系统需要保证多次运行进程后获得和预期相同的正确的结果（书上写的是相同结果，我认为不太严谨，比如OO里面的电梯，并不需要也不可能保证每次结果完全相同，只需要保证一些关键点的时序按照要求的顺序执行，管理好临界资源的访问即可）。而操作系统的保证就是第二单元提到的同步与互斥的概念。</p><h3 id="操作系统的功能"><a href="#操作系统的功能" class="headerlink" title="操作系统的功能"></a>操作系统的功能</h3><h4 id="管理计算机系统资源"><a href="#管理计算机系统资源" class="headerlink" title="管理计算机系统资源"></a>管理计算机系统资源</h4><h5 id="处理机管理"><a href="#处理机管理" class="headerlink" title="处理机管理"></a>处理机管理</h5><p>CPU的分配和运行以线程为基本单位（如果是不支持线程或者每个进程中只包含一个线程，也可以说以进程为基本单位）。对处理机的管理可以归结为对进程（线程）的管理，操作系统需要合理分配CPU资源给不同进程，进程的控制、同步、通信、死锁处理、CPU调度都是进程管理的内容，需要OS来管理。</p><h5 id="存储器管理"><a href="#存储器管理" class="headerlink" title="存储器管理"></a>存储器管理</h5><p>提高内存利用率，包括<strong>内存分配与回收</strong>，<strong>地址映射</strong>，内存<strong>保护和共享</strong>以及内存<strong>扩充</strong>等功能。</p><h5 id="文件管理"><a href="#文件管理" class="headerlink" title="文件管理"></a>文件管理</h5><p>计算机中的信息都是以文件的形式存在的（尤其是Linux设计哲学中“万物皆文件”），OS中负责文件管理的部分成为<strong>文件系统</strong>。文件管理包括文件存储空间的管理，目录管理和读写管理及文件保护等。</p><h5 id="设备管理"><a href="#设备管理" class="headerlink" title="设备管理"></a>设备管理</h5><p>提高设备的利用率，主要任务是完成用户的IO请求，包括缓冲管理，设备分配，设备处理和虚拟设备等功能。</p><h4 id="提供（OS本身就是）用户与计算机硬件系统之间的接口"><a href="#提供（OS本身就是）用户与计算机硬件系统之间的接口" class="headerlink" title="提供（OS本身就是）用户与计算机硬件系统之间的接口"></a>提供（OS本身就是）用户与计算机硬件系统之间的接口</h4><h5 id="命令接口"><a href="#命令接口" class="headerlink" title="命令接口"></a>命令接口</h5><p>用户利用操作命令来组织和控制作业的执行，分为<strong>联机控制方式</strong>和<strong>脱机控制方式</strong>两种控制方式。</p><p>相应地，根据控制方式的不同，可将命令接口分为<strong>联机命令接口</strong>和<strong>脱机命令接口</strong>两种接口。</p><p>联机命令接口也称为<strong>交互式</strong>命令接口，适用于分时或者实时系统的接口。用户通过控制台（或终端，后续统称为控制台）输入一条指令，控制权就转交给OS的<strong>命令解释程序</strong>（我理解为低级编译器）解释并执行输入的命令，如果需要返回结果则在控制台返回结果，再将控制权转回控制台，此时用户可输入下一条指令。突出了交互性（老板说一句，工人就完成一件事情并反馈，好比同声传译）。</p><p>脱机命令接口也称为<strong>批处理</strong>命令接口，适用于批处理系统。脱机用户不能直接实时干预作业的运行，而应该事先用相应的控制命令写成一份“作业操作说明书”，连同作业一起提交给系统。系统调度到该作业时，由命令解释程序逐条解释并执行“说明书”上的命令，使得用户间接控制作业的执行。突出了批处理性和自动性（老板出差之前将要做的事情都写在清单上，工人一条条做好）。</p><p>PS：这里就能体现出设计哲学，如果想实时干预，就只能一句句交互式执行；如果想当懒鬼享受自动化批处理就不能直接干涉，不能实时处理。</p><h5 id="程序接口"><a href="#程序接口" class="headerlink" title="程序接口"></a>程序接口</h5><p>由一组<strong>系统调用（也称广义指令）</strong>组成，（注意：系统调用==广义指令，程序接口包括系统调用）。用户通过<strong>在程序中</strong>（！！！用户不能直接在命令行使用，否则就成了命令接口）使用系统调用来请求操作系统提供服务（一种间接使用方式），例如输入输出的syscall（这部分输入申请外设），申请分配和回收内存等要求。</p><p>PS：大家喜欢使用的Windows的GUI（图形接口）最终还是通过调用程序接口来实现的。但严格来说，GUI不是OS的一部分，GUI底层调用的系统调用指令是OS的一部分。我认为可以理解为GUI是程序接口的进一步封装和抽象。</p><h4 id="实现对计算机资源的扩充"><a href="#实现对计算机资源的扩充" class="headerlink" title="实现对计算机资源的扩充"></a>实现对计算机资源的扩充</h4><p>1.OS将没有任何软件支持的裸机改造成功能更强，使用更方便的<strong>虚拟机</strong>（也成为扩充机器），封装并提供了更易于使用的接口和功能。</p><p>2.OS通过虚拟技术扩充了存储器的容量和CPU的“数量”。</p><h2 id="操作系统的发展历史"><a href="#操作系统的发展历史" class="headerlink" title="操作系统的发展历史"></a>操作系统的发展历史</h2><p><code>OS的基本类型主要有：批处理OS，分时OS，实时OS</code></p><h3 id="不同时期的操作系统及其特点（按时间顺序）"><a href="#不同时期的操作系统及其特点（按时间顺序）" class="headerlink" title="不同时期的操作系统及其特点（按时间顺序）"></a>不同时期的操作系统及其特点（按时间顺序）</h3><h4 id="手工操作阶段"><a href="#手工操作阶段" class="headerlink" title="手工操作阶段"></a>手工操作阶段</h4><p>缺点：1.用户独占全机，资源利用率低。2.CPU等待手工操作，利用不充分（人机矛盾很大，主要体现在CPU处理速度&gt;&gt;IO设备运行速度，容易出现CPU忙等现象）</p><h4 id="批处理阶段"><a href="#批处理阶段" class="headerlink" title="批处理阶段"></a>批处理阶段</h4><h5 id="单道批处理系统"><a href="#单道批处理系统" class="headerlink" title="单道批处理系统"></a>单道批处理系统</h5><p>特点：1.自动性：磁带上的一批作业能自动<strong>逐个</strong>运行，无需人工干预。<br>2.顺序性：磁带上的各个作业顺序进入内存，遵循FC(come)FS(service)原则，先调入内存的作业先完成。<br>3.单道性：内存中之多仅有一道程序运行，只有内存中程序完成或出现异常时，才换入其后继程序进入内存。</p><p>缺点：由于内存中永远仅有一道作业，因此运行期间发出请求IO设备服务时，CPU便处于等待低速IO设备完成的状态（忙等）。资源利用率和程序吞吐量很不理想。</p><h5 id="多道批处理系统"><a href="#多道批处理系统" class="headerlink" title="多道批处理系统"></a>多道批处理系统</h5><p>特点：1.多道，内存可以一次存放若干相互独立的作业<br>2.并发（宏观上并行，微观上串行，多道程序轮流占有CPU，交替执行）</p><p>优点：解决了单道批处理系统的缺点<br>缺点：用户响应时间长（平均周转时间长），原因是用户提交完作业之后必须等到作业结束，中途无法干预；不提供人机交互能力，用户不了解程序运行情况，也无法实时干预作业。</p><p><code>与单道程序操作系统相比，多道程序操作系统CPU和IO设备的利用率都会提高，不仅是CPU</code></p><h4 id="分时操作系统"><a href="#分时操作系统" class="headerlink" title="分时操作系统"></a>分时操作系统</h4><p>分时技术（时间片轮转技术）：<br>把处理机运行时间分成很短的时间片，按时间片轮流将CPU分配给各个作业使用。一个作业用完了其被分配的时间片后，就暂停运行，处理机将去下一个时间片被分配到的程序处运行。由于速度很快，时间片很短，因此每个用户都感觉自己独占一台计算机。</p><p>特点：同时性（也称为多路性），多个用户通过终端共享一台主机，这些终端连接在主机上，用户可以同时（或者基本同时）与主机进行交互操作。</p><p>独立性，用户可以同时与主机进行的交互操作互不干扰，好像独占一台主机。</p><p><strong>交互性</strong>，解决了多道批处理系统的缺点。</p><p><strong>及时性</strong>，解决了多道批处理系统的缺点。采用时间片轮转的方式使一个计算机同时为多个终端服务，用户请求能在很短的时间内得到相应。</p><p>不足：某些场合中可能还需系统在比时间片更短的时间内进行处理，如飞机订票或导弹制导系统。</p><h4 id="实时操作系统"><a href="#实时操作系统" class="headerlink" title="实时操作系统"></a>实时操作系统</h4><p>特点（优点）：解决了上述不足之处，可在某个时间限制内完成某些紧急任务而不需要时间片排队，突出了<strong>及时性</strong>和<strong>可靠性</strong>。</p><h5 id="硬实时系统"><a href="#硬实时系统" class="headerlink" title="硬实时系统"></a>硬实时系统</h5><p>必须绝对保证在规定时刻内完成任务，如导弹控制和飞机控制。</p><h5 id="软实时系统"><a href="#软实时系统" class="headerlink" title="软实时系统"></a>软实时系统</h5><p>可以接受偶尔违反时间规定且不会引起永久性损害，如飞机订票，银行管理。</p><h4 id="网络操作系统"><a href="#网络操作系统" class="headerlink" title="网络操作系统"></a>网络操作系统</h4><p>特点：网络中各种资源的共享和计算机之间的通信，各计算机相互独立工作（各自有各自的任务）。</p><h4 id="分布式计算机系统"><a href="#分布式计算机系统" class="headerlink" title="分布式计算机系统"></a>分布式计算机系统</h4><p>定义（需要满足的条件）：用于管理<strong>分布式计算机系统</strong>的操作系统统称为分布式计算机系统（听起来很奇怪感觉啥也没说）。由多台计算机组成，所有计算机地位同等，没有主次之分；每台计算机资源为所有用户共享；任意台计算机可以构成一个子系统，还可以重构；</p><p>特点：并行性，分布性</p><p><code>分布式计算机系统和网络操作系统的本质不同：分布式操作系统时若干计算机完成同一任务，而网络操作系统各个计算机有各自独立的任务。</code></p><h4 id="个人计算机操作系统"><a href="#个人计算机操作系统" class="headerlink" title="个人计算机操作系统"></a>个人计算机操作系统</h4><p>目前最广泛,Windows,Linux都属于个人计算机操作系统。<br>微型计算机操作系统似乎属于个人计算机操作系统</p><h4 id="嵌入式OS，服务器OS，智能手机OS等OS"><a href="#嵌入式OS，服务器OS，智能手机OS等OS" class="headerlink" title="嵌入式OS，服务器OS，智能手机OS等OS"></a>嵌入式OS，服务器OS，智能手机OS等OS</h4><p>自行了解即可</p><h2 id="操作系统运行环境"><a href="#操作系统运行环境" class="headerlink" title="操作系统运行环境"></a>操作系统运行环境</h2><h2 id="操作系统的结构"><a href="#操作系统的结构" class="headerlink" title="操作系统的结构"></a>操作系统的结构</h2><h2 id="操作系统的引导"><a href="#操作系统的引导" class="headerlink" title="操作系统的引导"></a>操作系统的引导</h2><p>设计哲学：在设计的方向上，想在一方面优化，必然要在另一方面有所损失，不存在完美的设计方案。</p><p>CPU运行的性能提速关键特点：乱序执行，分支预测，Cache；但是会遭到侧信道攻击的影响</p><p>多路性<br>独立性<br>及时性</p><h1 id="题型回顾"><a href="#题型回顾" class="headerlink" title="题型回顾"></a>题型回顾</h1><p>1.操作系统与用户通信接口通常不包括（D）<br>A.shell B.命令解释器 C.广义指令 D.缓存管理指令</p><p><code>解析：shell属于命令解释器，二者属于命令接口的联机控制接口；广义指令属于程序接口，缓存广义指令是操作系统内核的指令，对用户透明，用户不需要也无权管理缓存，缓存由OS全权管理。其实这道题出得不严谨，命令接口应该是一组键盘操作命令（联机）或作业控制命令（脱机）的集合，命令解释器更多的属于是解析这些接口的工具</code></p><p>2.计算机开机后，操作系统最终被加载到（D）<br>A. BIOS B.ROM C.EPROM D.RAM</p><p><code>解析：</code></p><p>3.说明库函数与系统调用的区别和联系：<br>答：<br>区别：库函数是语言或者应用程序的一部分，可以运行在用户空间中；而系统调用是操作系统的一部分，是内核<strong>为用户提供的程序接口</strong>，<strong>运行在内核空间</strong>中。<br>联系：许多库函数会使用到系统调用来实现自身的功能。且未使用系统调用的库函数，其执行效率通常比系统调用的高。因为<strong>使用系统调用需要上下文的切换以及状态的转换（用户态-&gt;核心态）</strong>。</p><p><code>解析：系统调用是内核提供给用户程序的，可以在用户程序或者一些库函数被使用（调用），但是系统调用的运行是在内核态的,千万要区分清楚</code></p><p>4.分时系统的一个重要性能是系统的响应时间，对操作系统的_____因素进行改进有利于改善系统的响应时间。<br>答：优先级+非抢占式调度算法<br><code>解析：优先级保证重要的作业优先尽快获得系统响应，非抢占式调度算法保证次要的作业不会迟迟得不到响应，这样兼顾的设计有利于改善响应时间</code></p><h1 id="lab1实验"><a href="#lab1实验" class="headerlink" title="lab1实验"></a>lab1实验</h1><h1 id><a href="#" class="headerlink" title></a></h1><p>PV操作不能对信号量直接进行运算操作，P(S)或者V(S)。如果问具体语义的话，<br>P(S):<br>while s&lt;=0 do skip<br>     S:=S-1;</p><p>V(S):S:=S+1;</p><p>管程是编译器实现的，简化了对共享资源的操作。与PV锁的关系可以用高级语言与汇编语言的关系类比</p>]]></content>
      
      
      
        <tags>
            
            <tag> OS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>fall_detection</title>
      <link href="/2023/01/31/fall-detection/"/>
      <url>/2023/01/31/fall-detection/</url>
      
        <content type="html"><![CDATA[<h1 id="基于python的跌倒识别的svm机器学习-model1（最初级版本）"><a href="#基于python的跌倒识别的svm机器学习-model1（最初级版本）" class="headerlink" title="基于python的跌倒识别的svm机器学习 model1（最初级版本）"></a>基于python的跌倒识别的svm机器学习 model1（最初级版本）</h1><p>代码包含五个py文件：data_disposal,get_feature,feature_extract,train,model_open</p><h2 id="数据处理与清洗部分"><a href="#数据处理与清洗部分" class="headerlink" title="数据处理与清洗部分"></a>数据处理与清洗部分</h2><h3 id="数据介绍"><a href="#数据介绍" class="headerlink" title="数据介绍"></a>数据介绍</h3><p>注明：本人使用的数据是.csv文件<br>客观数据包含：被测试人的身高，体重，年龄，性别<br>主要数据采集可从两方面进行入手，一方面是<strong>传感器的种类</strong>(Accelerometer,Gyroscope,Magnetometer)，另一方面是传感器<strong>佩戴的位置</strong>(RightPocket,Waist,Wrist,Ankle,Chest)<br>具体信息如图</p><p><img src="/2023/01/31/fall-detection/pic1.png" alt="pic1"></p><p><br><br></p><h3 id="数据处理方法"><a href="#数据处理方法" class="headerlink" title="数据处理方法:"></a>数据处理方法:</h3><p>将训练集二八划分，八成为训练集，两成为验证集</p><p>1.首先是<strong>data_disposal</strong>部分，将.csv文件里面的无关数据行剔除，只保留了图片中最下方以’;’隔开的数据，代码如下</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> osfolder <span class="token operator">=</span> <span class="token string">'./UMAFall_Dataset/'</span>   <span class="token comment"># my folder's path</span>dirs <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>folder<span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> dirs<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>                              <span class="token comment"># for check</span><span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> dirs<span class="token punctuation">:</span>    filepath <span class="token operator">=</span> folder <span class="token operator">+</span> <span class="token builtin">file</span>                 <span class="token comment">#each file's path</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment"># read row by row, which is called line here</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f_w<span class="token punctuation">:</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token string">"%"</span> <span class="token keyword">in</span> line <span class="token punctuation">:</span>    <span class="token comment"># if %, get rid of the uesless line</span>                <span class="token keyword">continue</span>            f_w<span class="token punctuation">.</span>write<span class="token punctuation">(</span>line<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用data_disposal对每一个Dataset中的数据进行预处理，直接运行即可</p><p><br><br></p><p>2.使用get_feature获取我需要的特征数据以便后续训练</p><p><strong>这里本人使用的思想是将sensor position的NO转化成不同的特征，避免重复传入sensor position,也避免不同的编号可能有大小之间的差异,导致训练器对不同身体部位的sensor有偏好</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> numpy <span class="token keyword">import</span> genfromtxtINF <span class="token operator">=</span> <span class="token number">1000000000</span>start <span class="token operator">=</span> <span class="token number">35</span><span class="token keyword">def</span> <span class="token function">Acc_data_extract</span><span class="token punctuation">(</span>file_name<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># there is 5 position mentioned above</span>    max_x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span>INF<span class="token punctuation">,</span><span class="token operator">-</span>INF<span class="token punctuation">,</span><span class="token operator">-</span>INF<span class="token punctuation">,</span><span class="token operator">-</span>INF<span class="token punctuation">,</span><span class="token operator">-</span>INF<span class="token punctuation">]</span>    max_y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span>INF<span class="token punctuation">,</span><span class="token operator">-</span>INF<span class="token punctuation">,</span><span class="token operator">-</span>INF<span class="token punctuation">,</span><span class="token operator">-</span>INF<span class="token punctuation">,</span><span class="token operator">-</span>INF<span class="token punctuation">]</span>    max_z <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span>INF<span class="token punctuation">,</span><span class="token operator">-</span>INF<span class="token punctuation">,</span><span class="token operator">-</span>INF<span class="token punctuation">,</span><span class="token operator">-</span>INF<span class="token punctuation">,</span><span class="token operator">-</span>INF<span class="token punctuation">]</span>    <span class="token comment"># from the file's name to ensure the label,fall is 1</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>file_name<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"Fall"</span><span class="token punctuation">,</span>start<span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>file_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        label <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        label <span class="token operator">=</span> <span class="token number">0</span>        <span class="token comment"># delimeter is ';'</span>    my_data <span class="token operator">=</span> genfromtxt<span class="token punctuation">(</span>file_name<span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">';'</span><span class="token punctuation">)</span>     <span class="token keyword">for</span> row <span class="token keyword">in</span> my_data<span class="token punctuation">:</span>        <span class="token comment"># row[5] is the type of sensor, 0 for Accelerator</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                 <span class="token comment"># row[6] is the position of sensor</span>            index <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>               <span class="token comment"># get the max value of the acceleration in x,y,z from various position(index) </span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">></span>max_x<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                max_x<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">></span>max_y<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                max_y<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">></span>max_z<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                max_z<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment">#x,y,z is list, label is int</span>    <span class="token keyword">return</span> max_x<span class="token punctuation">,</span>max_y<span class="token punctuation">,</span>max_z<span class="token punctuation">,</span>label<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3.feature_extract的介绍</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">import</span> get_feature<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np <span class="token comment"># folder's path is parameter, so that we can deal with dataset and judgeset simultaneously </span><span class="token keyword">def</span> <span class="token function">feature</span><span class="token punctuation">(</span>folder<span class="token punctuation">)</span><span class="token punctuation">:</span>                   dirs <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>folder<span class="token punctuation">)</span>    <span class="token comment"># initial,using the first data</span>    res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.8768832683563232</span><span class="token punctuation">,</span> <span class="token number">1.059326171875</span><span class="token punctuation">,</span> <span class="token number">1.0078125</span><span class="token punctuation">,</span> <span class="token number">4.048095703125</span><span class="token punctuation">,</span> <span class="token number">1.004150390625</span><span class="token punctuation">,</span>           <span class="token number">0.9856240749359131</span><span class="token punctuation">,</span><span class="token number">0.375</span><span class="token punctuation">,</span> <span class="token number">0.267333984375</span><span class="token punctuation">,</span> <span class="token number">2.31396484375</span><span class="token punctuation">,</span> <span class="token number">0.1005859375</span><span class="token punctuation">,</span>           <span class="token number">0.800494372844696</span><span class="token punctuation">,</span> <span class="token number">1.033447265625</span><span class="token punctuation">,</span> <span class="token number">0.7763671875</span><span class="token punctuation">,</span> <span class="token number">8.0</span><span class="token punctuation">,</span> <span class="token number">0.210205078125</span><span class="token punctuation">]</span>    res_feature <span class="token operator">=</span> <span class="token punctuation">[</span>res<span class="token punctuation">]</span>    res_label <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> dirs<span class="token punctuation">:</span>        <span class="token comment">#each file's path</span>        filepath <span class="token operator">=</span> folder <span class="token operator">+</span> <span class="token builtin">file</span>        <span class="token comment">#x finally become a big list consisting of 15 elements(each 5 position in x,y,z)                 </span>        x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">,</span>label <span class="token operator">=</span> get_feature<span class="token punctuation">.</span>Acc_data_extract<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>        x<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>y<span class="token punctuation">)</span>        x<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>z<span class="token punctuation">)</span>        <span class="token comment"># res_label is a list of label like [1,0,0,1...]</span>        res_label<span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">)</span>        <span class="token comment">#final is a ndarray which means [[],[],[]]</span>        final <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">]</span>        <span class="token comment">#absorb the new ndarray(matrix) of 15*1 by row </span>        res_feature <span class="token operator">=</span> np<span class="token punctuation">.</span>append<span class="token punctuation">(</span>res_feature<span class="token punctuation">,</span>values<span class="token operator">=</span>final<span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token comment"># return two ndarray that can be trained by svm</span>    <span class="token comment"># actually there is no need to use np.array here</span>    <span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>res_feature<span class="token punctuation">)</span> <span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>res_label<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><br><br><br><br><br><br><br><br></p><h3 id="svm分类器训练和参数调节"><a href="#svm分类器训练和参数调节" class="headerlink" title="svm分类器训练和参数调节"></a>svm分类器训练和参数调节</h3><p>之前对数据进行了一系列整理之后我们才可以用sklearn提供的库函数进行训练,对应的train模块如下</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> get_feature<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> svm<span class="token keyword">import</span> feature_extract<span class="token keyword">import</span> os<span class="token keyword">import</span> pickleX<span class="token punctuation">,</span>y <span class="token operator">=</span> feature_extract<span class="token punctuation">.</span>feature<span class="token punctuation">(</span><span class="token string">'./UMAFall_Dataset/'</span><span class="token punctuation">)</span>C <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token comment">#kernel,C and max_iter have all been tested and it's the  possible best result</span>svc <span class="token operator">=</span> svm<span class="token punctuation">.</span>SVC<span class="token punctuation">(</span>kernel<span class="token operator">=</span><span class="token string">'rbf'</span><span class="token punctuation">,</span> C<span class="token operator">=</span><span class="token number">1.25</span><span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token string">'auto'</span><span class="token punctuation">,</span>max_iter<span class="token operator">=</span><span class="token number">53</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token comment"># judge_set test to ensure the hit rate</span><span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token number">0</span>hit <span class="token operator">=</span> <span class="token number">0</span><span class="token comment"># open the files in judge set</span>judgeset_path <span class="token operator">=</span> <span class="token string">'./UMAFall_Judgeset/'</span>dirs <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>judgeset_path<span class="token punctuation">)</span><span class="token comment">#count the accuracy</span><span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> dirs<span class="token punctuation">:</span>    <span class="token builtin">sum</span> <span class="token operator">+=</span> <span class="token number">1</span>    filepath <span class="token operator">=</span> judgeset_path <span class="token operator">+</span> <span class="token builtin">file</span>  <span class="token comment"># each file's path</span>    a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d <span class="token operator">=</span> get_feature<span class="token punctuation">.</span>Acc_data_extract<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>    a<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>b<span class="token punctuation">)</span>    a<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>c<span class="token punctuation">)</span>    res <span class="token operator">=</span> svc<span class="token punctuation">.</span>predict<span class="token punctuation">(</span><span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span>d<span class="token punctuation">)</span><span class="token punctuation">:</span> hit <span class="token operator">+=</span><span class="token number">1</span>    <span class="token comment"># else: print(file)</span>hit_rate <span class="token operator">=</span> hit<span class="token operator">/</span><span class="token builtin">sum</span><span class="token keyword">print</span><span class="token punctuation">(</span>hit_rate<span class="token punctuation">)</span><span class="token comment"># store the model</span>s<span class="token operator">=</span>pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>svc<span class="token punctuation">)</span><span class="token comment"># wb+ is necessary,svm.model is its name</span>f<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'svm.model'</span><span class="token punctuation">,</span> <span class="token string">"wb+"</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"Done\n"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样一来，我们就不需要每次都重复训练，而是将我们得到的模型保存起来，成为一个.model文件，相应地，每次调用这个model我们也要有相应的读取功能model_open，如下</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token keyword">import</span> get_feature<span class="token keyword">import</span> os<span class="token comment"># just copy</span>f2<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'svm.model'</span><span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span>s2<span class="token operator">=</span>f2<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>model1<span class="token operator">=</span>pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token number">0</span>hit <span class="token operator">=</span> <span class="token number">0</span>judgeset_path <span class="token operator">=</span> <span class="token string">'./UMAFall_Judgeset/'</span>dirs <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>judgeset_path<span class="token punctuation">)</span><span class="token comment">#count the accuracy like above</span><span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> dirs<span class="token punctuation">:</span>    <span class="token builtin">sum</span> <span class="token operator">+=</span> <span class="token number">1</span>    filepath <span class="token operator">=</span> judgeset_path <span class="token operator">+</span> <span class="token builtin">file</span>  <span class="token comment"># each file's path</span>    a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d <span class="token operator">=</span> get_feature<span class="token punctuation">.</span>Acc_data_extract<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>    a<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>b<span class="token punctuation">)</span>    a<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>c<span class="token punctuation">)</span>    res <span class="token operator">=</span> model1<span class="token punctuation">.</span>predict<span class="token punctuation">(</span><span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span>d<span class="token punctuation">)</span><span class="token punctuation">:</span> hit <span class="token operator">+=</span><span class="token number">1</span>    <span class="token comment"># else: print(file)</span>hit_rate <span class="token operator">=</span> hit<span class="token operator">/</span><span class="token builtin">sum</span><span class="token keyword">print</span><span class="token punctuation">(</span>hit_rate<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><br><br><br><strong>最后结果如下图</strong></p><p><img src="/2023/01/31/fall-detection/pic2.png" alt="pic2"><br><br><br><br><br><br><br><strong>正确率如下图</strong></p><p><img src="/2023/01/31/fall-detection/pic3.png" alt="pic3"></p><p>约为<strong>84.2%</strong>,为本人目前在不同参数中获得的最优值<br><br><br></p><p>未成功识别judge set中数据如下，可能后续需要hard code<br>UMAFall_Subject_18_ADL_LyingDown_OnABed 2个</p><p>UMAFall_Subject_18_ADL_Hopping 7个</p><p>UMAFall_Subject_18_ADL_Jogging 7个</p><p>UMAFall_Subject_18_Fall_backwardFall 5个</p><p>UMAFall_Subject_18_Fall_forwardFall 4个</p><p>UMAFall_Subject_19_Fall_lateralFall 7个<br><br><br><br><br><br></p><h3 id="缺陷和改进方向"><a href="#缺陷和改进方向" class="headerlink" title="缺陷和改进方向"></a>缺陷和改进方向</h3><p><strong>缺陷</strong></p><p>1.数据没有被完全使用，由于给训练提供的参数数量越大，训练时间越长，且尚不清楚最终成果可以采集到的数据有哪些，本人目前只使用了Accelerator在x,y,z不同方向上的数据，另外两个sensor的数据目前没有使用，对应get_feature.py中row[5]的不同值。</p><p>2.没有利用统计规律对数据处理，如筛出不合理数据，对数据进行标准化等等，可能会受到单位的影响，如m/s和cm/s</p><p>3.训练参数缺乏合理性，由于本人编程技术和数理基础水平的限制和简化问题的需要，目前只取用了accelerator的x,y,z方向上的最大值作为是否摔倒的阈值，对于是否需要再取用身高体重等参数尚不确定，是否是越多越好呢？</p><p>4.代码可扩展性和鲁棒性较差，目前仅仅是为了训练模型而写出来</p><p>5.时间参数没有纳入考虑范围，可能会丢失部分有效信息<br><br><br></p><p><strong>改进方向</strong></p><p>1.无脑增加参数，将其他两个sensor也纳入考虑范围</p><p>2.初步处理数据时取平均值和方差，用(x-x平均值)/根号下x的方差</p><p>3.从实际情况出发，明确前端，数据库和训练模型之间的接口，对可用参数进行搜集，重新训练模型</p><h3 id="项目目前存在的的问题"><a href="#项目目前存在的的问题" class="headerlink" title="项目目前存在的的问题"></a>项目目前存在的的问题</h3><p>1.如何将目前得到的model如何嵌入并运用到微信小程序上去</p><p>2.实际收集的时候有哪些数据是可以被搜集的目前尚不确定，能否采集到智能设备中Accelerometer,Gyroscope,Magnetometer三个sensor的数据？如果可以采集，单位是否一致？如果不能采集，又将怎么处理？怎么重新训练模型？</p><p>3.如何应用数据库存储，在实践上实现对应的功能</p><p>4.准确率是否存在不足，还有一些功能如判断周围设备是否有同样的行为尚未完善，报警机制单一，无反馈，容易出现漏报和误报的情况。</p><p>5.数据库的隐私问题，立项书中介绍使用某差分方法进行信息保护，尚未解决</p><p>6.三个分工之间进度差距大，接口尚未明确，尚不清楚如何做出可在实际生活中运行的实物，没有明确的方向，需要进一步制定计划</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> svm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>排序算法</title>
      <link href="/2022/12/30/Sorting/"/>
      <url>/2022/12/30/Sorting/</url>
      
        <content type="html"><![CDATA[<h1 id="普通的排序算法（平均时间复杂度为O-n-2-）"><a href="#普通的排序算法（平均时间复杂度为O-n-2-）" class="headerlink" title="普通的排序算法（平均时间复杂度为O(n^2^)）"></a>普通的排序算法（平均时间复杂度为O(n^2^)）</h1><h2 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h2><p><strong>先上代码</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">insertionSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> arr<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">></span> arr<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> j<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> j<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>算法分析：<br>插入排序和打牌一样，手里的牌是有序的，抓到的牌放到合适的位置使之有序即可。<br>第一个if是保证代码的robustness,让代码更加健壮，这是一个很好的习惯。第一个for循环中i的位置是记录已经排序好的位置末尾的后一个待插入元素。i的初始值为1，因为第0个元素在最开始独立出现的时候就是排好序的（一共就一个元素，不需要排序了）。i不断增大的过程就是有序量增加的过程，标志着算法的进程加深。<br>第二个for循环中j的初始位置是i-1，也就是排好序的最后一个元素。在j–的过程中，相邻两个元素发生交换（通过swap函数实现数组元素的交换），直至arr[j]&lt;=arr[j+1]。<br><code>注意：这里的swap函数用了异或写法，目的是位运算加快速度并且节省temp的空间。平凡写法是创建一个temp变量作为中间人交换，a=a+b;b=a-b;a=a-b;也受到和异或一样的问题困扰。问题在于，如果某种排序算法中有a[i]和a[i]自己交换，则千万不可以用异或的方式，因为这会使得a[i]变成0,也就是说使用异或交换的时候，两个待交换的变量的内存不能是同一片地址。</code><br>*《算法导论》中对插入排序中第二个for循环实现略有不同，但本质一样，书中是用一个key变量保存了arr[i]，然后j=i-1;如果arr[j]&gt;key&amp;&amp;j&gt;=0,则arr[j+1]=arr[j];也就是不断地把数组元素往后移，直到arr[j]&lt;=key,最后把key放入arr[j+1],因为此时j+1的位置是“空的”（准确地说是和arr[j+2]相等，是无效信息)。本质无异。*<br><br><br><br>我还想说明一点，关于第一个for循环i的值的范围，有的地方是取头不取尾，有的地方取尾不取头，这个其实是根据循环不变量确定的。插入排序的循环不变量就是0到i-1都保持有序，并不是0到i-1都是其最终位置。所以i从1开始，并且要取到最末尾。而像选择排序则不同，选择排序选出最大或最小值之后那个值就是确定的，以最小值为例，i应该从0开始，循环条件为i &lt; arr.length-1,去掉末尾，因为前面都取到对应位置，最后一个元素自然也就在它自己的位置上。<br><br><br><br><br><br><br><br><br></p><h2 id="选择排序"><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h2><p><strong>先上代码</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">selectionSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> arr<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">int</span> minIndex <span class="token operator">=</span> i<span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>minIndex <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>minIndex<span class="token punctuation">]</span> <span class="token operator">?</span> j <span class="token operator">:</span> minIndex<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> i<span class="token punctuation">,</span> minIndex<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">int</span> tmp <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>算法分析：<br>顾名思义，选择排序是每次选一个最小的数字，放到i的位置。有了插入排序算法详细的介绍和剧透，选择排序显得很简单。<br>i是记录待排序的位置，循环不变量是0到i-1都是排序好的从小到大的。<br>这里i从0到<strong>小于</strong>arr.length-1在上面已经解释过。minIndex记录最小的值的下标，minIndex的初始值是i，一个个往后比较，如果有比arr[i]小的值则更新minIndex的值，然后交换。注意，这里minIndex有可能等于i，也就是说可能是swap(arr,i,i),根据之前的解释，这里就不能用异或swap。<br><br><br><br><br><br><br><br><br></p><h2 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h2><p><strong>代码如下</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token class-name">Bubblesort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">Boolean</span> flag<span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> arr<span class="token punctuation">.</span>length<span class="token operator">&lt;</span><span class="token number">2</span> <span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">></span><span class="token number">0</span> <span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">></span> arr<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> j<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>            flag<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> swap <span class="token punctuation">(</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        arr<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">^</span> arr<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">;</span>        arr<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">^</span> arr<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">;</span>        arr<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">^</span> arr<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>算法分析：<br>冒泡排序的核心思想是相邻两两交换使得最大数字到最后面去。冒泡这里外层for循环i从array.length-1开始，到1结束（i&gt;0)，原因是i其实是执行次数，为了让其含有更多信息，我们让i为待排序的位置，每次都确定一个最大的数字，i递减。<br>第二层for循环则是从0开始到i-1两两比较，如果前比后大则交换。<br>我还设了一个flag的布尔类型变量，意为当某一轮比较发现没有前比后大的情况说明排序已完成。开始设为false，如果产生比较则设为true，如果没有则还是false,在第二层循环结束后判定flag的值并且维护flag为false。<br><br><br><br><br><br><br><br><br></p><h1 id="高级排序"><a href="#高级排序" class="headerlink" title="高级排序"></a>高级排序</h1><h2 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h2><p><strong>先上代码</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token class-name">Mergesort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> arr<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">Mergesort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token class-name">Mergesort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span><span class="token keyword">int</span> <span class="token class-name">L</span><span class="token punctuation">,</span><span class="token keyword">int</span> <span class="token class-name">R</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">L</span><span class="token operator">==</span><span class="token class-name">R</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> mid<span class="token operator">=</span><span class="token class-name">L</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token operator">-</span><span class="token class-name">L</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Mergesort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span><span class="token class-name">L</span><span class="token punctuation">,</span>mid<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Mergesort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token class-name">R</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Merge</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span><span class="token class-name">L</span><span class="token punctuation">,</span>mid<span class="token punctuation">,</span><span class="token class-name">R</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token class-name">Merge</span> <span class="token punctuation">(</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> mid<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>      <span class="token keyword">int</span> p1<span class="token operator">=</span>l<span class="token punctuation">;</span>      <span class="token keyword">int</span> p2<span class="token operator">=</span>mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>      <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> help<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>r<span class="token operator">-</span>l<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token keyword">while</span><span class="token punctuation">(</span>p1<span class="token operator">&lt;=</span>mid <span class="token operator">&amp;&amp;</span> p2<span class="token operator">&lt;=</span>r<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>          help<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token operator">=</span> arr<span class="token punctuation">[</span>p1<span class="token punctuation">]</span><span class="token operator">&lt;</span>arr<span class="token punctuation">[</span>p2<span class="token punctuation">]</span><span class="token operator">?</span> arr<span class="token punctuation">[</span>p1<span class="token operator">++</span><span class="token punctuation">]</span><span class="token operator">:</span>arr<span class="token punctuation">[</span>p2<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">while</span> <span class="token punctuation">(</span>p1<span class="token operator">&lt;=</span>mid<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>          help<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token operator">=</span>arr<span class="token punctuation">[</span>p1<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">while</span> <span class="token punctuation">(</span>p2<span class="token operator">&lt;=</span>r<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>          help<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token operator">=</span>arr<span class="token punctuation">[</span>p2<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>help<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>          arr<span class="token punctuation">[</span>l<span class="token operator">+</span>i<span class="token punctuation">]</span><span class="token operator">=</span>help<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>算法分析：<br>归并排序利用的是分治思想，把数组一分为二，分别递归排序后通过merge算法合并。<br>注意：我写的Mergesort存在方法重载，第一个Mergesort是保证Mergesort接口的简洁性和鲁棒性，第二个Mergesort是具体的分治递归；最后通过Merge函数，在辅助数组help的帮助下合并两个数组，可见归并排序需要额外空间，不是原址的。<br><code>这里求mid的时候是mid=L+((R-L)&gt;&gt;1);结果自然是精确的，好处是不会溢出因为L+R溢出，而且位运算更快</code><br>PS:归并排序还可以用于在nlogn时间复杂度内求逆序对和小和，我会在后面的博客中更新。但是这些代码需要略微进行修改。<br><br><br><br><br><br></p><h2 id="堆排序"><a href="#堆排序" class="headerlink" title="堆排序"></a>堆排序</h2><p><strong>先上代码</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token class-name">Heapsort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">bulid_heap</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> len<span class="token operator">=</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">;</span> i <span class="token operator">>=</span><span class="token number">1</span> <span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>            len<span class="token operator">--</span><span class="token punctuation">;</span>            <span class="token function">heapify</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">bulid_heap</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">>=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">heapify</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>i<span class="token punctuation">,</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">heapify</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span><span class="token keyword">int</span> i<span class="token punctuation">,</span><span class="token keyword">int</span> len<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>       <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span> len<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>           <span class="token keyword">int</span> maxIndex<span class="token operator">=</span>i<span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>           <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">&lt;</span>len <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">></span>arr<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>               maxIndex<span class="token operator">=</span>i<span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">;</span>           <span class="token punctuation">&#125;</span>           <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">>=</span>arr<span class="token punctuation">[</span>maxIndex<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>           <span class="token keyword">else</span><span class="token punctuation">&#123;</span>               <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>i<span class="token punctuation">,</span>maxIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>               i<span class="token operator">=</span>maxIndex<span class="token punctuation">;</span>           <span class="token punctuation">&#125;</span>       <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span><span class="token keyword">int</span> i<span class="token punctuation">,</span><span class="token keyword">int</span> j<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">^</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>        arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">^</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>        arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">^</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>算法分析：<br>使用大顶（根）堆，通过建堆和维护最大堆的性质使得arr[0]永远是数组中最大的数字，每次将0和最后一个数字交换，并且把堆的长度缩小一个单位，并且维护最大堆的性质，如此往复，最后可以得到从小到大排序的数组。<br>swap从怂起见还是用temp为好，我个人用异或结果最后将arr[0]和arr[0]自身交换，导致第一个数字总是0，最后改写循环终止条件到arr[1]才解决问题。<br>heapify是自上而下的过程，注意判断终止条件，i<em>2+1如果超过了堆的长度（小心，堆的长度不一定是数组的长度，所以函数参数表中还有len）i</em>2+2就更无从谈起，这说明i是叶节点。值得注意的是，如果产生交换，i要移到被交换的那个下一个位置，也就是maxIndex的位置，如果i自己最大，则直接跳出，说明已经完成大顶堆性质的维护。这个过程可以用递归，代码会更简洁易懂，但是我认为直接while更好。<br>build_heap函数是初始化建立大顶堆的过程，《算法导论》指出，只要从第一个不是叶节点的元素开始维护大顶堆的性质即可，自下而上建堆。由于left=i<em>2+1,right=i</em>2+2,所以父节点是(i-1)/2,我们只要从最后一个元素的父节点开始，逐个递减地往上建堆即可。即(arr.length-2)&gt;&gt;1。</p><p>下面是左神的代码，他考虑了一个个给出数字的情况，额外添加了heapInsert函数</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">heapSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> arr<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">heapInsert</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> size <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">--</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span>size <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">heapify</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">--</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">heapInsert</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">while</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">></span> arr<span class="token punctuation">[</span><span class="token punctuation">(</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> index<span class="token punctuation">,</span> <span class="token punctuation">(</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>index <span class="token operator">=</span> <span class="token punctuation">(</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span> <span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">heapify</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">int</span> left <span class="token operator">=</span> index <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span>left <span class="token operator">&lt;</span> size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">int</span> largest <span class="token operator">=</span> left <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> size <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>left <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">></span> arr<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token operator">?</span> left <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> left<span class="token punctuation">;</span>largest <span class="token operator">=</span> arr<span class="token punctuation">[</span>largest<span class="token punctuation">]</span> <span class="token operator">></span> arr<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">?</span> largest <span class="token operator">:</span> index<span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>largest <span class="token operator">==</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> largest<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>index <span class="token operator">=</span> largest<span class="token punctuation">;</span>left <span class="token operator">=</span> index <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">int</span> tmp <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>heapInsert值得解释，虽然它和heapify是相同性质，但由于父节点只有一个，子节点却有两个，所以形式上heapInsert会简单很多，注意：heapInsert的终止条件是index等于0或者arr[index]小于等于arr[(index-1)/2]，左神只写了一句while(arr[index] &gt; arr[(index - 1) / 2]),包括后者，其实也包括了前者，因为index=0的时候，(index-1)/2也为0（java中的除法是取整除法，1.5-&gt;1,-1.5-&gt;-1），非常精妙。</p><p><br><br><br><br><br></p><h2 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h2><p>先导问题:荷兰国旗问题。<br>1.简单版：将一个数组排序，使得&lt;k的值在左侧的连续一片，其他的值在数组右侧。<br>2.升级版：将一个数组排序，使得&lt;k的值在左侧的连续一片，==k的值在数组中间的连续一片，&gt;k的值在数组的右边。（像荷兰的国旗一样三个不同颜色，其实法国国旗更贴切）<br>直接上升级版问题的代码：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">flagsort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span><span class="token keyword">int</span> k<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> mark1<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> mark2<span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>        <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;</span>mark2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&lt;</span>k<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>i<span class="token operator">++</span><span class="token punctuation">,</span><span class="token operator">++</span>mark1<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>k<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                i<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token operator">--</span>mark2<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span><span class="token keyword">int</span> i<span class="token punctuation">,</span><span class="token keyword">int</span> j<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> tmp<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>        tmp<span class="token operator">=</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>        arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span>tmp<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>算法分析：<br>mark1是小于k的边界的下标，mark2是大于k的边界的下标。我们所做的事情就是遍历数组，如果arr[i]小于k则将其与小于k的边界的后面一个元素交换，并且维护mark1的值。如果是等于k，就直接继续遍历，如果大于k，则将arr[i]与大于k的边界的前面一个元素交换，但是注意i不能++，即不继续遍历，因为交换过来的元素我们尚不清除它和k的大小关系。<br>注意两件事：<br>1.swap函数不能用异或，因为会有重复地址的可能。<br>2.mark1或者2的边界是包括对应性质的边界，边界外的不包括其对应性质。</p><p>为了和让快排用上我们的函数接口，左神把函数修改了一下。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">partition</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">,</span> <span class="token keyword">int</span> p<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">int</span> less <span class="token operator">=</span> l <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">int</span> more <span class="token operator">=</span> r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span>l <span class="token operator">&lt;</span> more<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">&lt;</span> p<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token operator">++</span>less<span class="token punctuation">,</span> l<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">></span> p<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token operator">--</span>more<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>l<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> less <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> more <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">int</span> tmp <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样我们能得到返回的两个下标，表示边界的情况，还能对数组分块处理（参数列表中有l,r）。<br><br><br><br><br><br><br>快速排序就是选定一个数组中的k值交换到数组末尾（一般直接选取最后一个元素），然后将剩余部分排序，把k与大于k的边界的值交换即可达到分治目的。如果分类方法采取荷兰国旗问题的非升级版（这样的我们称之为1.0快排），当选取的k有很多出现的时候，算法就会比较慢，因为升级版问题（2.0快排）把等于k的值也分块排好，这样我们分治的范围就更小了（这就是为什么要返回一个两个元素的数组标记边界的位置）。<br>当然，我们还嫌这样不够，众所周知（我最近才知道）即使是2.0快排的最差情况排序时间复杂度仍然是O(n^2^),因为如果对于一个有序数组（如1 2 3 4 5 6 7 8 9），我们每次都选取最后一个元素，通过国旗问题算法分块事件复杂度是O(n),但是我们的分治并没有起到作用，我们的子问题是变成了对1到8排序，如此下来，就变成了O(n^2^)。<br>核心问题是我们每次都选取最后一个数字作为k会遇到难受的问题，解决方法是随便选k，通过概率模型将算法的统计学意义上的时间复杂度降低。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">quickSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> arr<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">quickSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">quickSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>l <span class="token operator">&lt;</span> r<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> l <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>r <span class="token operator">-</span> l <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> p <span class="token operator">=</span> <span class="token function">partition</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> l<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">quickSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> l<span class="token punctuation">,</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">quickSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">partition</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">int</span> less <span class="token operator">=</span> l <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">int</span> more <span class="token operator">=</span> r<span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span>l <span class="token operator">&lt;</span> more<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token operator">++</span>less<span class="token punctuation">,</span> l<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">></span> arr<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token operator">--</span>more<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>l<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> more<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> less <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> more <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">int</span> tmp <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Math.random()可以生成[0,1)之间的等概率的数（计算机上等概率，不是数学上的等概率，因为计算机精度有限）。可以通过l+(int)(Math.random()*(r-l+1))等概率地取得l到r之间的任意一个整数。其余比较基础，注意递归条件是r&gt;l，不要反过来写（r==l则return之类的），因为过程中可能出现l&lt;r，比如对开头的2，2，2，排序，l=0,mark1=-1,最后返回的r是-1&lt;0。</p><p><br><br><br><br><br></p><h2 id="希尔排序"><a href="#希尔排序" class="headerlink" title="希尔排序"></a>希尔排序</h2><p><strong>先上代码</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">shellsort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> gap <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token operator">>></span><span class="token number">1</span> <span class="token punctuation">;</span>gap<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">;</span> gap<span class="token operator">/=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> gap<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span>j<span class="token operator">>=</span>gap <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">&lt;</span>arr<span class="token punctuation">[</span>j<span class="token operator">-</span>gap<span class="token punctuation">]</span><span class="token punctuation">;</span>j<span class="token operator">-=</span>gap <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>j<span class="token punctuation">,</span>j<span class="token operator">-</span>gap<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span><span class="token keyword">int</span> i<span class="token punctuation">,</span><span class="token keyword">int</span> j<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> tmp<span class="token operator">=</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>        arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span>tmp<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>算法分析：<br>每次只对gap间隔的数组元素进行排序，如长度为10的数组gap=3时对下标为{0，3，6，9}和{1，4，7}以及{2，5，8}的三个子数组分别进行排序，然后二分缩小gap的值。<br>第一个循环就是对gap的值进行控制的总循环，注意gap初始值取arr.length/2即可，因为arr.length只有0满足，不需要排序。<br>第二个和第三个循环合起来保证相同gap下的不同数组排序好，我的代码中使用的是插入排序完成此过程，因为插入排序对我个人而言比较好理解，每一个新的元素在插入排序的过程中都能找到自己在子数组中目前的正确相对位置。所以不需要重复考虑，i从gap开始遍历数组，j从i开始不断和j-gap比较并且交换，j再以gap为公差递减至gap。最里层的循环保证了子数组当前的有序性，倒数第二层的循环保证了完备性。注意i,j的初始值和j的终止条件。也可以通过冒泡完成，但是那个我理解不太了。<br>如下是C语言实现shellsort并通过冒泡排序实现子数组排序的代码。<br><img src="https://img-blog.csdnimg.cn/332a4e10a1d142dc9bdcba66cd76d793.png" alt="在这里插入图片描述"><br><br><br><br><br><br></p><h1 id="桶排序思想下的排序（不基于比较）"><a href="#桶排序思想下的排序（不基于比较）" class="headerlink" title="桶排序思想下的排序（不基于比较）"></a>桶排序思想下的排序（不基于比较）</h1><p>桶排序思想是一种不基于比较的排序，使用情况和数据状况有关。</p><h2 id="计数排序"><a href="#计数排序" class="headerlink" title="计数排序"></a>计数排序</h2><p>以空间换时间，适用于数据范围较窄的数据状况。如某地区人的年龄。<br>其本质是一种哈希，只不过哈希函数是本身，广义上来说只要哈希函数保证两个数的相对顺序不变（哈希函数离散地单调递增）即可。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>       <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> num <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>       <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> record <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> record<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>           <span class="token keyword">while</span> <span class="token punctuation">(</span>record<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>               <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>               record<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">--</span><span class="token punctuation">;</span>           <span class="token punctuation">&#125;</span>       <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span>   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>       <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> help <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">150</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>           help<span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>       <span class="token keyword">return</span> help<span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以下为左神代码</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">countSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> arr<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> max <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MIN_VALUE</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>max <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>max<span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bucket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>max <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>bucket<span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> bucket<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">while</span> <span class="token punctuation">(</span>bucket<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">--</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>arr<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> j<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><br><br><br><br><br></p><h2 id="基数排序"><a href="#基数排序" class="headerlink" title="基数排序"></a>基数排序</h2><p>数据能用进制表示，这里我们用十进制举例。<br>先将待排序元素处理成相同位数，即找到最高位数字，其余数字高位不足的补零。<br>有十个桶子，每个桶分别对应0,1,2……9。先考虑每个待排序元素的第一位（个位），从左往右依次放入个位数字对应的桶中。然后将其按照顺序从0号桶到9号桶倒出，同一个桶内的元素按队列处理，即先进先出，后进后出（FIFO）。然后考虑第二位（十位），重复上面操作。<br>算法分析：<br>由于最高位最后考虑，故最高位优先级最高。而先进先出原则没有违反同一个位数下的已经排好序部分的次序。所以算法是正确的，但是要准备这么多桶子总是很麻烦，我们采用等效的优化方式实现。<br>下面是左神的代码，我肯定现在写不出这么好的。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">radixSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> arr<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">radixSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">maxbits</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">maxbits</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">int</span> max <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MIN_VALUE</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>max <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>max<span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span>max <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>res<span class="token operator">++</span><span class="token punctuation">;</span>max <span class="token operator">/=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> res<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">radixSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> begin<span class="token punctuation">,</span> <span class="token keyword">int</span> end<span class="token punctuation">,</span> <span class="token keyword">int</span> digit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">final</span> <span class="token keyword">int</span> radix <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bucket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>end <span class="token operator">-</span> begin <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> d <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> d <span class="token operator">&lt;=</span> digit<span class="token punctuation">;</span> d<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> count <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>radix<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> begin<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> end<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>j <span class="token operator">=</span> <span class="token function">getDigit</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>count<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> radix<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>count<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> count<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> count<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> end<span class="token punctuation">;</span> i <span class="token operator">>=</span> begin<span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>j <span class="token operator">=</span> <span class="token function">getDigit</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>bucket<span class="token punctuation">[</span>count<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>count<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">--</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> begin<span class="token punctuation">,</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> end<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">,</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> bucket<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getDigit</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> d <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>不得不感慨一句这个函数的封装要做好，我们不妨从getDigit函数开始分析，d是要得到的位数，x是待取位数的数字对象。x除以10的d-1次方，就可以让小数点前移d-1次，最后留下待取的数字为个位数。如果超过由于整数除法就直接为0（之前说高位不足补0），这里直接用pow函数取int就可以实现，我觉得很神奇，不过也算是学到了。最后记得模10取个位。<br>再分析maxbit函数，先通过遍历找出数组中最大的数字。然后不断除10直到为0，逻辑上res先++再max除10。</p><p>radixSort是核心部分，记录下一个常变量radix表示基底（进制）先建立一个bucket数组存放出桶的数字，大小和待排序数字元素个数相同。由于数字最高有几位就出入桶几次，所以最外层的d的for循环就是总的操作次数，并且d记录了目前操作的位数信息，即第几位。再建立一个count数组，数组大小和进制相等，如10进制就10个，意义对应0到9。然后遍历arr中待排序元素，分别取第d位的数字然后放入count中。再另起一个for循环对count进行处理，处理之后的结果是count[i]表示&lt;=i的元素个数，这样求前缀和的方式让count数组实现了对bucket的分块，我们后面就会体现出来。<br>然后注意从右往左遍历arr数组，此时我们默认arr数组在d-1位及以前都是有序排列好的（循环不变量）。取出第i个元素的d位数字j，对应到count数组中的count[j]。把arr[i]填入bucket的第count[j]位置，也就是bucket[count[j] - 1] = arr[i];然后维护count[j]的值。这样的操作能使得出桶完成。然后将桶中的元素分别按顺序赋值给arr。</p><p>正确性分析：count起到了对bucket分段的作用，比如j为3，count[3]=5,现在从右往左遍历arr，会优先把j=3的d-1位及以内的更大的数字填入count[3]对应的位置（bucket[5-1]）。然后维护count[3]的值，因为下一个j==3的数字进来就要往左边靠了。重要的是这样不会影响j&lt;3和j&gt;3的值分块的正确性，j&lt;=3无需置疑，count[3]–不会影响小于等于1或2的个数。而j=4或者更大的数字也不会受到影响，因为count[3]–的含义只是那个位置被占据，并不影响小于等于3的个数。所以分片正确性不变。</p>]]></content>
      
      
      <categories>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 排序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>The use of Command</title>
      <link href="/2022/12/30/The-use-of-Command/"/>
      <url>/2022/12/30/The-use-of-Command/</url>
      
        <content type="html"><![CDATA[<h1 id="windows-常用快捷键"><a href="#windows-常用快捷键" class="headerlink" title="windows 常用快捷键"></a>windows 常用快捷键</h1><p><strong>1.ctrl+c  复制</strong><br><strong>2.ctrl+v  粘贴</strong><br><strong>3.ctrl+a  全选</strong><br><strong>4.ctrl+t   剪切</strong><br><strong>5.ctrl+z  撤回</strong><br>6.ctrl+f 查找<br><strong>7.ctrl+s 保存</strong><br>8.ctrl+h 替换<br>9.alt+f4 关闭窗口<br>10.shift+delete(键盘右下角数字部分0右边的一个点) 永久删除<br><strong>11.Windows+r 运行（可以用于打开cmd命令窗口）</strong><br><strong>12.Windows+e 打开我的电脑</strong><br><strong>13.Windows+shift+s 给屏幕截图</strong><br>14.最下方任务栏（下图）点右键可选中并打开任务管理器<br><img src="https://img-blog.csdnimg.cn/7a57337c0e894555b8c92db6db0a5efd.png" alt="在这里插入图片描述"><br><em>也可以用ctrl+shift+esc打开任务管理器</em></p><h1 id="Dos命令"><a href="#Dos命令" class="headerlink" title="Dos命令"></a>Dos命令</h1><p><del>CMD都打不开你学个P，先打开吧</del></p><h2 id="CMD-打开方式"><a href="#CMD-打开方式" class="headerlink" title="CMD 打开方式"></a>CMD 打开方式</h2><ol><li>点左下角windows图表+windows系统+命令提示符</li><li><strong>WINDOWS+R+输入cmd</strong></li><li>在桌面空白处或者文件夹空白处摁住shift点鼠标右键，选择打开powershell(或者摁s键)</li><li><img src="https://img-blog.csdnimg.cn/3a115e9f4cb54e08871090276ed7c1b5.png" alt="在这里插入图片描述"><br>点击空白处，在地址栏前面写cmd+<kbd>space</kbd>+路径+回车</li></ol><p><em>以管理员方式运行</em>：windows系统+命令提示符+右键+更多+以管理员……<img src="https://img-blog.csdnimg.cn/d636aed568c546a99a95b0ca360e244f.png#pic_center" alt="在这里插入图片描述"><br><strong>或者右键点击左下角windows再选以管理员身份运行powershell.</strong></p><h2 id="常用的Dos命令"><a href="#常用的Dos命令" class="headerlink" title="常用的Dos命令"></a>常用的Dos命令</h2><p><code>1.盘符切换</code> <img src="https://img-blog.csdnimg.cn/60248d248daf47789938fe292c383588.png" alt="在这里插入图片描述"><br><strong>注意C后面的:必须是英文</strong></p><p><code>2.查看当前目录下的所有文件</code><br><img src="https://img-blog.csdnimg.cn/355f4bf05563473388d7df08e664a247.png#pic_center" alt="在这里插入图片描述"><br><strong>dir即可</strong> dir意为dirctory（目录）</p><p><code>3.切换目录</code><br><img src="https://img-blog.csdnimg.cn/0431947a7b95410092bea2e142423d22.png#pic_center" alt="在这里插入图片描述"><br>cd 意为change directory 切换目录<br><strong>直接cd只能进入cd目录内的文件，如D后面cd java(注意中间有空格)</strong></p><p><strong>cd /d 可以在同级目录或者硬盘间之间切换（注意/d是正斜杠且cd与它之间有空格,而且后面要跟硬盘名称和冒号，==冒号千万不可少==）</strong></p><p><strong>cd . .意为返回根目录(注意cd和两个点之间可以有空格但两个点之间不能有空格)</strong></p><p><code>4.清理屏幕</code><br><strong>cls+回车</strong><br>cls意为clear screen</p><p><code>5.退出终端</code><br><strong>exit+回车</strong></p><p><code>6.查看电脑IP</code><br><strong>ipconfig+回车</strong><br><img src="https://img-blog.csdnimg.cn/21464e26f7cf40efa3a38c962df9766c.png#pic_center" alt="在这里插入图片描述"></p><p><code>7.打开一些应用</code><br><strong>计算器：calc+回车</strong><br><strong>画图：mspaint+回车</strong><br><strong>记事本：notepad+回车(此时还没有保存，ctrl+s后会向你确认保存在哪里)</strong></p><p><code>8.ping一个网址</code><br><em><strong>注意在命令行里面粘贴最好不要ctrl+c或者v因为可能会推出，单机鼠标右键就是粘贴</strong></em></p><p>ping+<kbd>space</kbd>+网页地址+回车<br><img src="https://img-blog.csdnimg.cn/bfac8425e7d143f0baf231eb4a333a6a.png#pic_center" alt="在这里插入图片描述"><br><code>9.创建一个新的文件夹或者文件</code><br><img src="https://img-blog.csdnimg.cn/14d691630d644ba2a8d2985c648d6bb1.png" alt="在这里插入图片描述"><br>此处我选择了桌面<br><strong>创建文件夹：md+<kbd>space</kbd>+文件夹名字</strong><br><strong>创建文件：先cd到文件夹，回车，再在下一行cd+<kbd>></kbd>+文件夹名字(带文件扩展名如.txt)</strong></p><p><code>10.文件的删除</code><br><strong>若要删除文件夹，先要删除其中的内容再删文件，否则会有目录不为空的警告且删除失败</strong><br><strong>删除文件：del+<kbd>space</kbd>+文件名</strong><br><strong>删除文件夹：rd+<kbd>space</kbd>+文件名</strong>            <em>这里r是remove的意思</em><br><img src="https://img-blog.csdnimg.cn/5eea107b39014f328194f11d9d17e572.png" alt="在这里插入图片描述"></p>]]></content>
      
      
      <categories>
          
          <category> 电脑技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 命令行 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MarkDown有关语法</title>
      <link href="/2022/12/30/The-use-of-MarkDown/"/>
      <url>/2022/12/30/The-use-of-MarkDown/</url>
      
        <content type="html"><![CDATA[<p>本文为从CSDN的教学中分离出来的教程<br>你好！ 这是你第一次使用 <strong>Markdown编辑器</strong> 所展示的欢迎页。如果你想学习如何使用Markdown编辑器, 可以仔细阅读这篇文章，了解一下Markdown的基本语法知识。（这里写的好像没有什么用）</p><h2 id="CSDN的自吹时间"><a href="#CSDN的自吹时间" class="headerlink" title="CSDN的自吹时间"></a>CSDN的自吹时间</h2><p>我们对Markdown编辑器进行了一些功能拓展与语法支持，除了标准的Markdown编辑器功能，我们增加了如下几点新功能，帮助你用它写博客：</p><ol><li><strong>全新的界面设计</strong> ，将会带来全新的写作体验；</li><li>在创作中心设置你喜爱的代码高亮样式，Markdown <strong>将代码片显示选择的高亮样式</strong> 进行展示；</li><li>增加了 <strong>图片拖拽</strong> 功能，你可以将本地的图片直接拖拽到编辑区域直接展示；</li><li>全新的 <strong>KaTeX数学公式</strong> 语法；</li><li>增加了支持<strong>甘特图的mermaid语法<a href="%5Bmermaid%E8%AF%AD%E6%B3%95%E8%AF%B4%E6%98%8E%5D(https://mermaidjs.github.io/)">^1</a></strong> 功能；</li><li>增加了 <strong>多屏幕编辑</strong> Markdown文章功能；</li><li>增加了 <strong>焦点写作模式、预览模式、简洁写作模式、左右区域同步滚轮设置</strong> 等功能，功能按钮位于编辑区域与预览区域中间；</li><li>增加了 <strong>检查列表</strong> 功能。</li></ol><h2 id="功能快捷键"><a href="#功能快捷键" class="headerlink" title="功能快捷键"></a>功能快捷键</h2><p>撤销：<kbd>Ctrl/Command</kbd> + <kbd>Z</kbd><br>重做：<kbd>Ctrl/Command</kbd> + <kbd>Y</kbd><br>加粗：<kbd>Ctrl/Command</kbd> + <kbd>B</kbd><br>斜体：<kbd>Ctrl/Command</kbd> + <kbd>I</kbd><br>标题：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>H</kbd><br>无序列表：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>U</kbd><br>有序列表：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>O</kbd><br>检查列表：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>C</kbd><br>插入代码：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>K</kbd><br>插入链接：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>L</kbd><br>插入图片：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>G</kbd><br>查找：<kbd>Ctrl/Command</kbd> + <kbd>F</kbd><br>替换：<kbd>Ctrl/Command</kbd> + <kbd>G</kbd><br>注意这里<kbd>圆边矩形</kbd>好像是圆边矩形框框。<br>圆边矩形的写法是&lt;&gt;里面加kbd再接&lt;/&gt;,/后面加kbd。</p><h2 id="合理的创建标题，有助于目录的生成"><a href="#合理的创建标题，有助于目录的生成" class="headerlink" title="合理的创建标题，有助于目录的生成"></a>合理的创建标题，有助于目录的生成</h2><p>直接输入1次<kbd>#</kbd>，并按下<kbd>space</kbd>后，将生成1级标题。<br>输入2次<kbd>#</kbd>，并按下<kbd>space</kbd>后，将生成2级标题。<br>以此类推，我们支持6级标题。有助于使用<code>TOC</code>语法后生成一个完美的目录。（两个英文的<kbd>`</kbd>之间的东西会被红色标注，这个点是和波浪线一起的，效果如上面的TOC）</p><h2 id="如何改变文本的样式"><a href="#如何改变文本的样式" class="headerlink" title="如何改变文本的样式"></a>如何改变文本的样式</h2><p>n个连续的#后面加<kbd>space</kbd>是n级大纲(标题)</p><p><em>强调文本</em> <em>强调文本</em>     在两个*或_之间</p><p><strong>加粗文本</strong> <strong>加粗文本</strong>   在上面的基础上两边各多一个符号  </p><p>==标记文本==  两对等号</p><p><del>删除文本</del>  两对波浪号</p><blockquote><p>引用文本     一个大于号</p></blockquote><p>H<del>2</del>O is是液体。 两个波浪号之间的数字是下标</p><p>2^10^ 运算结果是 1024. 两个^之间是上标</p><p>C^2^<del>5</del> 这个可能不是特别好看就是说</p><h2 id="插入链接与图片"><a href="#插入链接与图片" class="headerlink" title="插入链接与图片"></a>插入链接与图片</h2><p>链接: <a href="https://www.csdn.net/">link</a>.<br><a href="https://blog.csdn.net/godlikegu?spm=1000.2115.3001.5343">顾哥的博客</a>.<br>[]＋(),     []里面是名称,()里面是超链接<br>图片: <img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw" alt="Alt"><br>!+[]+(),!是英文的，[]里面是图片显示失败的之后名字，()里面是图片地址。<br>比如<img src alt="图片失败后的名称"></p><p>带尺寸的图片: ![Alt](<a href="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw">https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw</a> =50x30)<br>超链接后面+<kbd>space</kbd>+<kbd>=</kbd>+<kbd>宽</kbd>+<kbd>x（就是小写的x英文字母）</kbd>+<kbd>高</kbd></p><p>居中的图片: <img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw#pic_center" alt="Alt"><br>井号#紧跟图片链接后面加pic_center</p><p>居中并且带尺寸的图片: ![Alt](<a href="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw#pic_center">https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw#pic_center</a> =30x30)</p><p>先#pic_center+<kbd>space</kbd>+宽x高</p><h2 id="如何插入一段漂亮的代码片"><a href="#如何插入一段漂亮的代码片" class="headerlink" title="如何插入一段漂亮的代码片"></a>如何插入一段漂亮的代码片</h2><p>去<a href="https://mp.csdn.net/console/configBlog">博客设置</a>页面，选择一款你喜欢的代码片高亮样式，下面展示同样高亮的 <code>代码片</code>.</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// An highlighted block</span><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">'bar'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>三个连续的`开头，结束时也要，头三个点后面写语言类型</p><h2 id="生成一个适合你的列表"><a href="#生成一个适合你的列表" class="headerlink" title="生成一个适合你的列表"></a>生成一个适合你的列表</h2><p>英文减号就是黑色圆点（无序表头）</p><ul><li>项目<ul><li>项目<ul><li>项目</li></ul></li></ul></li></ul><p>直接1.就是有序表头</p><ol><li>项目1   </li><li>项目2</li><li>项目3<br><kbd>-</kbd>+<kbd>space</kbd>+<kbd>[]</kbd>+<kbd>任务名</kbd>+<kbd>space</kbd>是任务box，[]里只加x（大小写均可）就是打勾。</li></ol><ul><li>[] mission</li><li><input disabled type="checkbox"> 计划任务</li><li><input checked disabled type="checkbox"> 完成任务</li></ul><h2 id="创建一个表格"><a href="#创建一个表格" class="headerlink" title="创建一个表格"></a>创建一个表格</h2><p>一个简单的表格是这么创建的：<br>项目     | Value<br>|——–|———–|<br>电脑  | $1600<br>手机  | $12<br>导管  | $1</p><h3 id="设定内容居中、居左、居右"><a href="#设定内容居中、居左、居右" class="headerlink" title="设定内容居中、居左、居右"></a>设定内容居中、居左、居右</h3><p>使用<code>:---------:</code>居中<br>使用<code>:----------</code>居左<br>使用<code>----------:</code>居右<br>| 第一列       | 第二列         | 第三列        |<br>|:———–:| ————-:|:————-|<br>| 第一列文本居中 | 第二列文本居右  | 第三列文本居左 |</p><h3 id="SmartyPants"><a href="#SmartyPants" class="headerlink" title="SmartyPants"></a>SmartyPants</h3><p>SmartyPants将ASCII标点字符转换为“智能”印刷标点HTML实体。例如：<br>|    TYPE   |ASCII                          |HTML<br>|—————-|——————————-|—————————–|<br>|Single backticks|<code>&#39;Isn&#39;t this fun?&#39;</code>            |’Isn’t this fun?’            |<br>|Quotes          |<code>&quot;Isn&#39;t this fun?&quot;</code>            |”Isn’t this fun?”            |<br>|Dashes          |<code>-- is en-dash, --- is em-dash</code>|– is en-dash, — is em-dash|</p><h2 id="创建一个自定义列表"><a href="#创建一个自定义列表" class="headerlink" title="创建一个自定义列表"></a>创建一个自定义列表</h2><dl><dt>Markdown</dt><dd>Text-to-HTML conversion tool</dd></dl><dl><dt>冒号后面还要加至少一个space<br>:  John</dt><dd>Luke</dd></dl><h2 id="如何创建一个注脚"><a href="#如何创建一个注脚" class="headerlink" title="如何创建一个注脚"></a>如何创建一个注脚</h2><p>一个具有注脚的文本。<a href="%E6%B3%A8%E8%84%9A%E7%9A%84%E8%A7%A3%E9%87%8A">^2</a></p><h2 id="注释也是必不可少的"><a href="#注释也是必不可少的" class="headerlink" title="注释也是必不可少的"></a>注释也是必不可少的</h2><p> Markdown将文本转换为 HTML。<br>*[Markdown]:    语言<br>*[HTML]:   超文本标记语言</p><h2 id="KaTeX数学公式"><a href="#KaTeX数学公式" class="headerlink" title="KaTeX数学公式"></a>KaTeX数学公式</h2><p>您可以使用渲染LaTeX数学表达式 <a href="https://khan.github.io/KaTeX/">KaTeX</a>:</p><p>Gamma公式展示 $\Gamma(n) = (n-1)!\quad\forall<br>n\in\mathbb N$ 是通过欧拉积分</p><p>$$<br>\Gamma(z) = \int_0^\infty t^{z-1}e^{-t}dt,.<br>$$</p><blockquote><p>你可以找到更多关于的信息 <strong>LaTeX</strong> 数学表达式<a href="http://meta.math.stackexchange.com/questions/5020/mathjax-basic-tutorial-and-quick-reference">here</a>.</p></blockquote><h2 id="新的甘特图功能，丰富你的文章"><a href="#新的甘特图功能，丰富你的文章" class="headerlink" title="新的甘特图功能，丰富你的文章"></a>新的甘特图功能，丰富你的文章</h2><pre class="line-numbers language-mermaid" data-language="mermaid"><code class="language-mermaid"><span class="token keyword">gantt</span>        dateFormat  YYYY-MM-DD        title Adding GANTT diagram functionality to mermaid        section 现有任务        已完成               <span class="token operator">:</span>done,    des1, 2014-01-06,2014-01-08        进行中               <span class="token operator">:</span>active,  des2, 2014-01-09, 3d        计划一               <span class="token operator">:</span>         des3, after des2, 5d        计划二               <span class="token operator">:</span>         des4, after des3, 5d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>关于 <strong>甘特图</strong> 语法，参考 <a href="https://mermaidjs.github.io/">这儿</a>,</li></ul><h2 id="UML-图表"><a href="#UML-图表" class="headerlink" title="UML 图表"></a>UML 图表</h2><p>可以使用UML图表进行渲染。 <a href="https://mermaidjs.github.io/">Mermaid</a>. 例如下面产生的一个序列图：</p><pre class="line-numbers language-mermaid" data-language="mermaid"><code class="language-mermaid"><span class="token keyword">sequenceDiagram</span>张三 <span class="token arrow operator">->></span> 李四<span class="token operator">:</span> 你好！李四, 最近怎么样?李四<span class="token arrow operator">-->></span>王五<span class="token operator">:</span> 你最近怎么样，王五？李四<span class="token arrow operator">--x</span> 张三<span class="token operator">:</span> 我很好，谢谢!李四<span class="token arrow operator">-x</span> 王五<span class="token operator">:</span> 我很好，谢谢!<span class="token keyword">Note right of</span> 王五<span class="token operator">:</span> 李四想了很长时间, 文字太长了&lt;br/>不适合放在一行.李四<span class="token arrow operator">-->></span>张三<span class="token operator">:</span> 打量着王五...张三<span class="token arrow operator">->></span>王五<span class="token operator">:</span> 很好... 王五, 你怎么样?<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这将产生一个流程图。:</p><pre class="line-numbers language-mermaid" data-language="mermaid"><code class="language-mermaid"><span class="token keyword">graph</span> LRA<span class="token text string">[长方形]</span> <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span> <span class="token label property">链接</span> <span class="token arrow operator">--></span></span> B<span class="token text string">((圆))</span>A <span class="token arrow operator">--></span> C<span class="token text string">(圆角长方形)</span>B <span class="token arrow operator">--></span> D<span class="token text string">&#123;菱形&#125;</span>C <span class="token arrow operator">--></span> D<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>关于 <strong>Mermaid</strong> 语法，参考 <a href="https://mermaidjs.github.io/">这儿</a>,</li></ul><h2 id="FLowchart流程图"><a href="#FLowchart流程图" class="headerlink" title="FLowchart流程图"></a>FLowchart流程图</h2><p>我们依旧会支持flowchart的流程图：</p><pre class="line-numbers language-mermaid" data-language="mermaid"><code class="language-mermaid">flowchatst=>start<span class="token operator">:</span> 开始e=>end<span class="token operator">:</span> 结束op=>operation<span class="token operator">:</span> 我的操作cond=>condition<span class="token operator">:</span> 确认？st<span class="token arrow operator">-></span>op<span class="token arrow operator">-></span>condcond<span class="token text string">(yes)</span>->econd<span class="token text string">(no)</span>->op<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>关于 <strong>Flowchart流程图</strong> 语法，参考 <a href="http://adrai.github.io/flowchart.js/">这儿</a>.</li></ul><h2 id="导出与导入"><a href="#导出与导入" class="headerlink" title="导出与导入"></a>导出与导入</h2><h3 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h3><p>如果你想尝试使用此编辑器, 你可以在此篇文章任意编辑。当你完成了一篇文章的写作, 在上方工具栏找到 <strong>文章导出</strong> ，生成一个.md文件或者.html文件进行本地保存。</p><h3 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h3><p>如果你想加载一篇你写过的.md文件，在上方工具栏可以选择导入功能进行对应扩展名的文件导入，<br>继续你的创作。</p>]]></content>
      
      
      <categories>
          
          <category> MarkDown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MarkDown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>My second post</title>
      <link href="/2022/12/29/My-second-post/"/>
      <url>/2022/12/29/My-second-post/</url>
      
        <content type="html"><![CDATA[<p>My girlfriend treats me very well</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
